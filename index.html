<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯çˆ±èŒ¶é“º - ç»Ÿä¸€ç‰ˆæœ¬</title>
    <link rel="stylesheet" href="unified-styles.css">
    <style>
        /* åŠ¨ç”»æç¤ºæ ·å¼ */
        .floating-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            z-index: 9999;
            animation: floatingMessage 2s ease-out forwards;
            pointer-events: none;
        }

        .floating-message.success {
            background: rgba(76, 175, 80, 0.9);
        }

        .floating-message.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .floating-message.cost {
            background: rgba(255, 152, 0, 0.9);
        }

        @keyframes floatingMessage {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -60%) scale(0.9);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="header">
            <h1>å¯çˆ±èŒ¶é“º - å¤é£ç»è¥å°æ¸¸æˆ</h1>
            <div class="subtitle">ç»Ÿä¸€ç‰ˆæœ¬ v2.0 | æ•°æ®å®Œå…¨åŒæ­¥</div>
        </div>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <button class="nav-btn" onclick="location.reload()">èŒ¶é“º</button>
            <button class="nav-btn" onclick="goToRiceVillage()" id="rice-village-btn" disabled>ç¨»é¦™æ‘</button>
            <button class="nav-btn" onclick="showInventory()">èƒŒåŒ…</button>
            <button class="nav-btn" onclick="showRecipeUnlockStatus()">é…æ–¹è§£é”</button>
            <button class="nav-btn" onclick="showSettings()">è®¾ç½®</button>
            <button class="nav-btn" onclick="showHelp()">å¸®åŠ©</button>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="section">
            <div class="section-title">æ¸¸æˆçŠ¶æ€</div>
            <table class="status-table">
                <tr>
                    <th>é‡‘å¸</th>
                    <th>ç­‰çº§</th>
                    <th>ç»éªŒ</th>
                    <th>å¤©æ°”</th>
                    <th>å½“å‰ä½ç½®</th>
                    <th>æ¸¸æˆæ—¶é—´</th>
                </tr>
                <tr>
                    <td id="funds-display">1000 ğŸª™</td>
                    <td id="level-display">1çº§</td>
                    <td id="exp-display">0/100</td>
                    <td id="weather-display">â˜€ï¸ æ™´å¤©</td>
                    <td>èŒ¶é“º</td>
                    <td id="game-time">ç¬¬1å¤©</td>
                </tr>
            </table>
        </div>

        <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’® -->
        <div class="section">
            <div class="section-title">å¿«é€Ÿæµ‹è¯•</div>
            <div class="top-menu-bar">
                <button class="menu-btn" onclick="quickTestGrill()">æµ‹è¯•çƒ¤è‚‰</button>
                <button class="menu-btn" onclick="quickTestCat()">æµ‹è¯•çŒ«å’ª</button>
                <button class="menu-btn" onclick="quickTestCustomer()">æµ‹è¯•é¡¾å®¢</button>
                <button class="menu-btn" onclick="addTestItems()">æ·»åŠ æµ‹è¯•ç‰©å“</button>
                <button class="menu-btn" onclick="quickTestPlanting()">æµ‹è¯•ç§æ¤</button>
                <button class="menu-btn" onclick="unlockRiceVillage()">è§£é”ç¨»é¦™æ‘</button>
                <button class="menu-btn" onclick="forceCreateCustomer()">ç”Ÿæˆé¡¾å®¢</button>
                <button class="menu-btn" onclick="showVipTestPanel()" style="background: #ff6b6b; color: white;">VIPé¡¾å®¢æµ‹è¯•</button>
                <button class="menu-btn" onclick="forceCatVisit()">å¬å”¤çŒ«å’ª</button>
                <button class="menu-btn" onclick="resetCatStatus()">é‡ç½®çŒ«å’ªçŠ¶æ€</button>
                <button class="menu-btn" onclick="debugCatData()">æŸ¥çœ‹çŒ«å’ªæ•°æ®</button>
                <button class="menu-btn" onclick="triggerNaming()">é‡æ–°è§¦å‘å‘½å</button>
                <button class="menu-btn" onclick="testGifts()">æµ‹è¯•ç¤¼ç‰©ç³»ç»Ÿ</button>
            </div>
        </div>

        <!-- ç§æ¤åŒºåŸŸ -->
        <div class="section">
            <div class="section-title">ç§æ¤åŒºåŸŸ (2å—åœ°)</div>
            <div class="farm-grid" id="farm-grid">
                <!-- åŠ¨æ€ç”Ÿæˆç§æ¤åœ°å— -->
            </div>
        </div>

        <!-- å¨æˆ¿å·¥ä½œåŒº -->
        <div class="section">
            <div class="section-title">å¨æˆ¿å·¥ä½œåŒº</div>
            
            <!-- ç‚‰ç¶åŒº -->
            <div style="margin-bottom: 15px;">
                <h4 style="font-size: 12px; margin-bottom: 8px;">ç‚‰ç¶åˆ¶èŒ¶åŒº (2ä¸ªç‚‰ç¶)</h4>
                <table class="workspace-table">
                    <thead>
                        <tr>
                            <th>ç‚‰ç¶</th>
                            <th>çŠ¶æ€</th>
                            <th>é…æ–¹</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="stoves-table">
                        <!-- åŠ¨æ€ç”Ÿæˆç‚‰ç¶çŠ¶æ€ -->
                    </tbody>
                </table>
            </div>

            <!-- æ¡ˆæ¿åŒº -->
            <div style="margin-bottom: 15px;">
                <h4 style="font-size: 12px; margin-bottom: 8px;">æ¡ˆæ¿åŠ å·¥åŒº (2ä¸ªæ¡ˆæ¿)</h4>
                <table class="workspace-table">
                    <thead>
                        <tr>
                            <th>æ¡ˆæ¿</th>
                            <th>çŠ¶æ€</th>
                            <th>é…æ–¹</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="boards-table">
                        <!-- åŠ¨æ€ç”Ÿæˆæ¡ˆæ¿çŠ¶æ€ -->
                    </tbody>
                </table>
            </div>

            <!-- çƒ¤è‚‰æ¶åŒº -->
            <div id="grill-section" style="display: none;">
                <h4 style="font-size: 12px; margin-bottom: 8px;">çƒ¤è‚‰æ¶ (è§£é”åå¯ç”¨)</h4>
                <table class="workspace-table">
                    <thead>
                        <tr>
                            <th>çƒ¤è‚‰æ¶</th>
                            <th>çŠ¶æ€</th>
                            <th>é…æ–¹</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="grill-table">
                        <!-- åŠ¨æ€ç”Ÿæˆçƒ¤è‚‰æ¶çŠ¶æ€ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é¡¾å®¢æœåŠ¡åŒº -->
        <div class="section">
            <div class="section-title">é¡¾å®¢æœåŠ¡åŒº</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>å½“å‰é¡¾å®¢</th>
                        <th>è®¢å•è¯¦æƒ…</th>
                        <th>è€å¿ƒå€¼</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="customer-table">
                    <tr>
                        <td colspan="4">ç­‰å¾…é¡¾å®¢åˆ°æ¥...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- çŒ«å’ªç³»ç»Ÿ -->
        <div class="section">
            <div class="section-title">çŒ«å’ªç³»ç»Ÿ</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>çŒ«å’ª</th>
                        <th>äº²å¯†åº¦</th>
                        <th>çŠ¶æ€</th>
                        <th>å–‚é£Ÿæ¬¡æ•°</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="cats-table">
                    <!-- åŠ¨æ€ç”ŸæˆçŒ«å’ªçŠ¶æ€ -->
                </tbody>
            </table>
        </div>

        <!-- åˆ¶ä½œå¥½çš„èŒ¶é¥® -->
        <div class="section">
            <div class="section-title">åˆ¶ä½œå¥½çš„èŒ¶é¥®</div>
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>èŒ¶é¥®åç§°</th>
                        <th>æ•°é‡</th>
                        <th>åˆ¶ä½œæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="made-teas-table">
                    <tr>
                        <td colspan="4">æš‚æ— åˆ¶ä½œå¥½çš„èŒ¶é¥®</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- èƒŒåŒ…å¿«é€ŸæŸ¥çœ‹ -->
        <div class="section">
            <div class="section-title">èƒŒåŒ…å¿«é€ŸæŸ¥çœ‹</div>
            <div class="top-menu-bar">
                <button class="menu-btn" onclick="toggleInventorySection('seeds')">ç§å­</button>
                <button class="menu-btn" onclick="toggleInventorySection('ingredients')">åŸæ–™</button>
                <button class="menu-btn" onclick="toggleInventorySection('toppings')">å°æ–™</button>
                <button class="menu-btn" onclick="toggleInventorySection('meats')">è‚‰ç±»</button>
            </div>
            
            <div id="inventory-display" style="margin-top: 10px;">
                <div class="collapsible-section" id="seeds-section">
                    <table class="inventory-table">
                        <thead><tr><th>ç§å­åç§°</th><th>æ•°é‡</th><th>ä»·æ ¼</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="seeds-inventory"></tbody>
                    </table>
                </div>
                
                <div class="collapsible-section" id="ingredients-section">
                    <table class="inventory-table">
                        <thead><tr><th>åŸæ–™åç§°</th><th>æ•°é‡</th><th>ç”¨é€”</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="ingredients-inventory"></tbody>
                    </table>
                </div>
                
                <div class="collapsible-section" id="toppings-section">
                    <table class="inventory-table">
                        <thead><tr><th>å°æ–™åç§°</th><th>æ•°é‡</th><th>æ¥æº</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="toppings-inventory"></tbody>
                    </table>
                </div>
                
                <div class="collapsible-section" id="meats-section">
                    <table class="inventory-table">
                        <thead><tr><th>è‚‰ç±»åç§°</th><th>æ•°é‡</th><th>çƒ¤åˆ¶ä»·æ ¼</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="meats-inventory"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‚¬æµ®è°ƒè¯•é¢æ¿ -->
    <div class="debug-panel" id="debug-panel" onclick="toggleDebugPanel()">
        ğŸ› 
        <div class="debug-content" id="debug-content" style="display: none;">
            <div class="debug-header">
                <span>ğŸ›  è°ƒè¯•é¢æ¿</span>
                <button class="modal-close" onclick="toggleDebugPanel()">Ã—</button>
            </div>
            <div style="padding: 10px; font-size: 11px;">
                <div id="debug-log" style="max-height: 200px; overflow-y: auto; background: #f9fafb; padding: 8px; border: 1px solid #e5e7eb; margin-bottom: 8px;"></div>
                <button class="action-btn" onclick="clearDebugLog()" style="font-size: 11px;">æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- JavaScriptæ–‡ä»¶ -->
            <script src="unified-weather-system.js"></script>
        <script src="unified-inventory-system.js"></script>
        <script src="unified-core-system.js"></script>
    <script src="tea-shop-manager.js"></script>
    <script>
        // å…¨å±€èŒ¶é“ºç®¡ç†å™¨å˜é‡
        window.teaShopManager = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸµ èŒ¶é“ºé¡µé¢åŠ è½½å®Œæˆ');

            try {
                // ç›´æ¥åˆ›å»ºèŒ¶é“ºç®¡ç†å™¨å®ä¾‹
                if (typeof TeaShopManager !== 'undefined') {
                    window.teaShopManager = new TeaShopManager();
                    window.teaShopManager.init();
                    console.log('âœ… èŒ¶é“ºç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    console.error('âŒ TeaShopManager ç±»æœªå®šä¹‰');
                }
            } catch (error) {
                console.error('âŒ èŒ¶é“ºç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }

            // ä¸å†åœ¨é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å‘½åéœ€æ±‚
            // å‘½åçª—å£ç°åœ¨ç”±äº²å¯†åº¦è¾¾åˆ°3000æ—¶è§¦å‘
        });

        // æ£€æŸ¥æ˜¯å¦éœ€è¦çŒ«å’ªå‘½å
        function checkCatNamingRequired() {
            console.log('ğŸ± å¼€å§‹æ£€æŸ¥çŒ«å’ªå‘½åéœ€æ±‚');

            if (!teaShopManager || !teaShopManager.core.initialized) {
                console.log('èŒ¶é“ºç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼Œå»¶è¿Ÿæ£€æŸ¥çŒ«å’ªå‘½å');
                setTimeout(checkCatNamingRequired, 500);
                return;
            }

            const gameData = teaShopManager.core.gameData;
            const cats = gameData.teaShop.cats;

            console.log('ğŸ± æ¸¸æˆæ•°æ®:', {
                hasShownCatNaming: gameData.meta.hasShownCatNaming,
                catsIntimacy: cats.intimacy,
                currentCat: cats.currentCat
            });

            // æ£€æŸ¥æ˜¯å¦å·²ç»ç»™çŒ«å’ªèµ·è¿‡åå­— - æ›´ä¸¥æ ¼çš„åˆ¤æ–­
            const hasNamedCat = cats.currentCat && cats.currentCat !== 'ç­‰å¾…çŒ«å’ªåˆ°æ¥' && cats.currentCat.trim() !== '';

            console.log('ğŸ± è¯¦ç»†æ£€æŸ¥:', {
                currentCat: cats.currentCat,
                intimacyKeys: Object.keys(cats.intimacy),
                hasNamedCat: hasNamedCat
            });

            console.log('ğŸ± æ£€æŸ¥ç»“æœ:', {
                hasShownCatNaming: gameData.meta.hasShownCatNaming,
                hasNamedCat: hasNamedCat,
                shouldShowModal: !gameData.meta.hasShownCatNaming && !hasNamedCat
            });

            // æ£€æŸ¥æ˜¯å¦è®¾ç½®è¿‡"å·²å¼¹å‡ºå‘½åçª—å£"æ ‡è®°
            if (!gameData.meta.hasShownCatNaming && !hasNamedCat) {
                console.log('ğŸ± é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œå¼¹å‡ºçŒ«å’ªå‘½åçª—å£');
                showCatNamingModal();
                gameData.meta.hasShownCatNaming = true;
                teaShopManager.core.saveGameData();
            } else {
                console.log('ğŸ± ä¸éœ€è¦å¼¹å‡ºå‘½åçª—å£');
            }
        }

        // æ˜¾ç¤ºçŒ«å’ªå‘½åæ¨¡æ€æ¡†
        function showCatNamingModal(originalCatName) {
            window.currentNamingCat = originalCatName; // ä¿å­˜å½“å‰è¦å‘½åçš„çŒ«å’ª
            const modalContent = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; justify-content: center; align-items: center;">
                    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); max-width: 450px; text-align: center;">
                        <h3 style="margin-top: 0; color: #333;">ğŸ‰ æ­å–œå¼€å¯ç¥ç§˜åœ°å›¾ç¨»é¦™æ‘ï¼</h3>
                        <p style="margin: 20px 0; line-height: 1.6; color: #666;">
                            ä½ çš„ <strong>${originalCatName}</strong> äº²å¯†åº¦è¾¾åˆ°äº†3000ï¼<br>
                            ç¥ç§˜çš„ç¨»é¦™æ‘å¤§é—¨ä¸ºä½ æ•å¼€äº†...<br>
                            è¯·ç»™è¿™åªçŒ«çŒ«èµ·ä¸ªåå­—ï¼Œç„¶åå°±å¯ä»¥å¸¦ç€ä½ çš„çŒ«çŒ«ä¼™ä¼´å»æ¸¸ç©äº†ï¼
                        </p>
                        <div style="margin: 20px 0;">
                            <input type="text" id="cat-name-input" placeholder="è¯·è¾“å…¥çŒ«å’ªåå­—"
                                   style="padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 200px; font-size: 14px;"
                                   maxlength="10">
                        </div>
                        <div>
                            <button onclick="confirmCatNameAndGoToVillage()"
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                ç¡®è®¤å¹¶å‰å¾€ç¨»é¦™æ‘
                            </button>
                            <button onclick="confirmCatNameOnly()"
                                    style="background: #ccc; color: #333; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                æš‚æ—¶ä¸å»
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalContent);

            // èšç„¦åˆ°è¾“å…¥æ¡†
            setTimeout(() => {
                const input = document.getElementById('cat-name-input');
                if (input) input.focus();
            }, 100);
        }

        // ç¡®è®¤çŒ«å’ªåå­—å¹¶å‰å¾€ç¨»é¦™æ‘
        function confirmCatNameAndGoToVillage() {
            const input = document.getElementById('cat-name-input');
            let catName = input.value.trim();

            if (!catName) {
                alert('è¯·è¾“å…¥çŒ«å’ªåå­—ï¼');
                return;
            }

            applyCatName(catName);
            // å‰å¾€ç¨»é¦™æ‘
            setTimeout(() => {
                window.open('rice-village.html', '_blank');
            }, 500);
        }

        // ç¡®è®¤çŒ«å’ªåå­—ä½†ä¸å‰å¾€ç¨»é¦™æ‘
        function confirmCatNameOnly() {
            const input = document.getElementById('cat-name-input');
            let catName = input.value.trim();

            if (!catName) {
                alert('è¯·è¾“å…¥çŒ«å’ªåå­—ï¼');
                return;
            }

            applyCatName(catName);
        }

        // ç¡®è®¤çŒ«å’ªåå­—ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
        function confirmCatName() {
            confirmCatNameOnly();
        }

        // è·³è¿‡å‘½åï¼ˆéšæœºå‘½åï¼‰
        function skipCatNaming() {
            const randomNames = ['å°ç™½', 'å°é»‘', 'å°èŠ±', 'å°æ©˜', 'å°ç°', 'å’ªå’ª', 'å–µå–µ', 'å›¢å­', 'å¸ƒä¸', 'å¥¶èŒ¶'];
            const randomName = randomNames[Math.floor(Math.random() * randomNames.length)];
            applyCatName(randomName);
        }

        // åº”ç”¨çŒ«å’ªåå­—
        function applyCatName(catName) {
            if (teaShopManager && teaShopManager.core.initialized) {
                const cats = teaShopManager.core.gameData.teaShop.cats;
                const originalName = window.currentNamingCat;

                if (!originalName) {
                    console.log('ğŸ± é”™è¯¯ï¼šæ²¡æœ‰æ‰¾åˆ°è¦å‘½åçš„çŒ«å’ª');
                    return;
                }

                console.log(`ğŸ± å¼€å§‹å‘½å: ${originalName} â†’ ${catName}`);

                // ä¿å­˜è‡ªå®šä¹‰åå­—
                cats.customNames[originalName] = catName;

                // ç”Ÿæˆéšæœºæˆ˜æ–—å±æ€§å’Œç±»å‹
                const catType = Math.random() < 0.5 ? 'tank' : 'damage';
                cats.combatStats[originalName] = {
                    type: catType,
                    baseHp: Math.floor(Math.random() * 51) + 100,   // 100-150åŸºç¡€è¡€é‡
                    baseAttack: Math.floor(Math.random() * 11) + 10, // 10-20åŸºç¡€æ”»å‡»
                    level: 1,
                    hp: 0, // å°†åœ¨ä¸‹é¢è®¡ç®—
                    attack: 0, // å°†åœ¨ä¸‹é¢è®¡ç®—
                    currentHp: 0 // å½“å‰è¡€é‡
                };

                // è®¡ç®—1çº§æ—¶çš„å±æ€§
                const stats = cats.combatStats[originalName];
                if (catType === 'tank') {
                    stats.hp = stats.baseHp + 20; // å¦å…‹å‹+20è¡€é‡
                    stats.attack = stats.baseAttack + 1; // å¦å…‹å‹+1æ”»å‡»
                } else {
                    stats.hp = stats.baseHp + 3; // è¾“å‡ºå‹+3è¡€é‡
                    stats.attack = stats.baseAttack + 5; // è¾“å‡ºå‹+5æ”»å‡»
                }
                stats.currentHp = stats.hp;

                console.log(`ğŸ± ç”Ÿæˆæˆ˜æ–—å±æ€§:`, cats.combatStats[originalName]);

                // å¦‚æœè¿™åªçŒ«å’ªæ­£åœ¨è®¿é—®ï¼Œéœ€è¦æ›´æ–°æ˜¾ç¤ºä½†ä¸æ”¹å˜currentCat
                // currentCatä¿æŒåŸå§‹åå­—ï¼Œæ˜¾ç¤ºæ—¶ç”¨è‡ªå®šä¹‰åå­—

                teaShopManager.core.saveGameData();
                teaShopManager.renderCatsTable();
                teaShopManager.addDebugLog(`ğŸ± ${originalName} ç°åœ¨å« ${catName} äº†ï¼æˆ˜æ–—å±æ€§å·²ç”Ÿæˆï¼`);

                console.log('ğŸ± å‘½åå®Œæˆï¼Œæœ€ç»ˆæ•°æ®:', {
                    customNames: cats.customNames,
                    combatStats: cats.combatStats
                });
            }

            // å…³é—­æ¨¡æ€æ¡†
            const modal = document.querySelector('[style*="position: fixed"][style*="z-index: 2000"]');
            if (modal) {
                modal.remove();
            }
        }

        // æµ‹è¯•çŒ«å’ªå‘½ååŠŸèƒ½












        // å¼ºåˆ¶ç”Ÿæˆé¡¾å®¢ç”¨äºæµ‹è¯•
        function forceCreateCustomer() {
            console.log('ğŸ” å¼ºåˆ¶ç”Ÿæˆé¡¾å®¢');

            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            // è°ƒç”¨ç”Ÿæˆé¡¾å®¢çš„æ–¹æ³•
            window.teaShopManager.generateCustomer();
            window.teaShopManager.updateCustomerDisplay();
            console.log('ğŸ” é¡¾å®¢å·²ç”Ÿæˆ');
        }

        // å¼ºåˆ¶çŒ«å’ªè®¿é—®ç”¨äºæµ‹è¯•
        function forceCatVisit() {
            console.log('ğŸ” å¼ºåˆ¶å¬å”¤çŒ«å’ª');

            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            // å¼ºåˆ¶è§¦å‘çŒ«å’ªè®¿é—®
            const cats = window.teaShopManager.core.gameData.teaShop.cats;
            const availableCats = Object.keys(cats.intimacy || {});
            if (availableCats.length === 0) {
                console.log('âŒ æ²¡æœ‰å¯è®¿é—®çš„çŒ«å’ªæ•°æ®');
                return;
            }
            const randomCat = availableCats[Math.floor(Math.random() * availableCats.length)];

            cats.currentCat = randomCat;
            cats.visitStartTime = Date.now();
            cats.visitDuration = 10000; // åœç•™10ç§’

            window.teaShopManager.addDebugLog(`ğŸ± å¼ºåˆ¶å¬å”¤: ${randomCat} æ¥è®¿äº†ï¼`);
            window.teaShopManager.renderCatsTable();
            console.log('ğŸ” çŒ«å’ªå·²å¬å”¤:', randomCat);
        }

        // é‡ç½®çŒ«å’ªçŠ¶æ€
        function resetCatStatus() {
            console.log('ğŸ” é‡ç½®çŒ«å’ªçŠ¶æ€');

            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            const cats = window.teaShopManager.core.gameData.teaShop.cats;

            // é‡ç½®è®¿é—®çŠ¶æ€
            cats.currentCat = 'ç­‰å¾…çŒ«å’ªåˆ°æ¥';
            cats.visitStartTime = null;
            cats.visitDuration = null;

            console.log('ğŸ” çŒ«å’ªçŠ¶æ€å·²é‡ç½®:', {
                currentCat: cats.currentCat,
                visitStartTime: cats.visitStartTime,
                intimacyData: cats.intimacy
            });

            window.teaShopManager.renderCatsTable();
            window.teaShopManager.addDebugLog('ğŸ± çŒ«å’ªè®¿é—®çŠ¶æ€å·²é‡ç½®');
        }

        // æŸ¥çœ‹çŒ«å’ªæ•°æ®
        function debugCatData() {
            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            const cats = window.teaShopManager.core.gameData.teaShop.cats;
            console.log('ğŸ” === çŒ«å’ªæ•°æ®è¯¦æƒ… ===');
            console.log('å½“å‰è®¿é—®çŒ«å’ª:', cats.currentCat);
            console.log('è®¿é—®å¼€å§‹æ—¶é—´:', cats.visitStartTime);
            console.log('è®¿é—®æŒç»­æ—¶é—´:', cats.visitDuration);
            console.log('äº²å¯†åº¦æ•°æ®:', cats.intimacy);
            console.log('å–‚é£Ÿæ¬¡æ•°:', cats.feedCount);
            console.log('å¯ç”¨çŒ«å’ªåˆ—è¡¨:', Object.keys(cats.intimacy || {}));

            // æ£€æŸ¥æ˜¯å¦æœ‰"é‚¹è®¸"è¿™åªçŒ«
            if (cats.intimacy['é‚¹è®¸']) {
                console.log('ğŸ± æ‰¾åˆ°é‚¹è®¸! äº²å¯†åº¦:', cats.intimacy['é‚¹è®¸']);
            } else {
                console.log('ğŸ± æ²¡æœ‰æ‰¾åˆ°é‚¹è®¸');
            }
        }



        // é‡æ–°è§¦å‘å‘½åæ£€æŸ¥
        function triggerNaming() {
            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            console.log('ğŸ” æ‰‹åŠ¨è§¦å‘å‘½åæ£€æŸ¥...');
            window.teaShopManager.checkAllCatsForNaming();
        }

        // å…³é—­ç¤¼ç‰©å¼¹çª—
        function closeGiftModal() {
            const modals = document.querySelectorAll('div[style*="position: fixed"]');
            modals.forEach(modal => {
                if (modal.innerHTML.includes('ğŸ')) {
                    modal.remove();
                }
            });
        }

        // æµ‹è¯•ç¤¼ç‰©ç³»ç»Ÿ
        function testGifts() {
            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            const cats = window.teaShopManager.core.gameData.teaShop.cats;
            console.log('ğŸ æµ‹è¯•ç¤¼ç‰©ç³»ç»Ÿ...');

            // æ‰¾åˆ°ç¬¬ä¸€åªçŒ«å’ªè¿›è¡Œæµ‹è¯•
            const firstCat = Object.keys(cats.intimacy)[0];
            if (firstCat) {
                console.log(`ğŸ ä¸º ${firstCat} æµ‹è¯•500äº²å¯†åº¦ç¤¼ç‰©`);
                window.teaShopManager.giveCatGift(firstCat, 500);
            } else {
                console.log('âŒ æ²¡æœ‰æ‰¾åˆ°çŒ«å’ª');
            }
        }

        // æ˜¾ç¤ºé…æ–¹è§£é”çŠ¶æ€
        function showRecipeUnlockStatus() {
            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            window.teaShopManager.showRecipeUnlockStatus();
        }

        // å…³é—­é…æ–¹è§£é”çŠ¶æ€çª—å£
        function closeRecipeUnlockStatus() {
            // é¦–å…ˆå°è¯•é€šè¿‡IDæŸ¥æ‰¾
            const modal = document.getElementById('recipe-unlock-modal');
            if (modal) {
                modal.remove();
                return;
            }
            
            // å¤‡ç”¨æ–¹æ³•ï¼šæŸ¥æ‰¾æ‰€æœ‰å›ºå®šå®šä½çš„å…ƒç´ 
            const modals = document.querySelectorAll('div[style*="position: fixed"]');
            modals.forEach(modal => {
                if (modal.innerHTML.includes('é…æ–¹è§£é”çŠ¶æ€')) {
                    modal.remove();
                }
            });
        }

        // VIPé¡¾å®¢æµ‹è¯•é¢æ¿
        function showVipTestPanel() {
            if (!window.teaShopManager) {
                alert('âŒ èŒ¶é“ºç®¡ç†å™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }

            const manager = window.teaShopManager;
            const gameData = manager.core.gameData;
            const customerVisits = gameData.teaShop.customerVisits || {};
            const unlockedRecipes = gameData.teaShop.unlockedRecipes || [];

            // VIPé¡¾å®¢é…ç½®
            const vipCustomers = [
                { name: 'å‡Œå°è·¯', recipe: 'æ´›ç¥ç«ç‘°é¥®', visits: 1, chance: 100 },
                { name: 'èŠ±èŠ±', recipe: 'æ¡‚åœ†çº¢æ£èŒ¶', visits: 1, chance: 100 },
                { name: 'æ±Ÿé£é£', recipe: 'ç„¦é¦™å¤§éº¦èŒ¶', visits: 2, chance: 100 },
                { name: 'æ±Ÿä¸‰', recipe: 'ä¸‰èŠ±å†³æ˜èŒ¶', visits: 2, chance: 100 },
                { name: 'æ±Ÿå››', recipe: 'è–„è·ç”˜è‰å‡‰èŒ¶', visits: 2, chance: 100 },
                { name: 'æ± äº‘æ——', recipe: 'é™ˆçš®å§œç±³èŒ¶', visits: 2, chance: 50, guaranteed: 3 },
                { name: 'æ±Ÿæ½®', recipe: 'å†¬ç“œè·å¶é¥®', visits: 3, chance: 60, guaranteed: 4 },
                { name: 'æ± æƒŠæš®', recipe: 'å¤æ³•é…¸æ¢…æ±¤', visits: 2, chance: 30, guaranteed: 3 },
                { name: 'æ±Ÿæ••å°', recipe: 'å°åŠæ¢¨æ±¤', visits: 3, chance: 40, guaranteed: 5 },
                { name: 'å§¬åˆ«æƒ…', recipe: 'ç¥ç§˜åŠŸèƒ½1', visits: 6, chance: 0, guaranteed: 6 },
                { name: 'æ± ä¹ä¿¡', recipe: 'ç¥ç§˜åŠŸèƒ½2', visits: 6, chance: 0, guaranteed: 6 },
                { name: 'ç‹¸æ€’', recipe: 'ç¥ç§˜åŠŸèƒ½3', visits: 6, chance: 0, guaranteed: 6 }
            ];

            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.id = 'vip-test-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 2000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;

            const panel = document.createElement('div');
            panel.style.cssText = `
                background: white;
                border-radius: 15px;
                padding: 20px;
                max-width: 90vw;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            `;

            let customerRows = '';
            vipCustomers.forEach(customer => {
                const currentVisits = customerVisits[customer.name] || 0;
                const isUnlocked = unlockedRecipes.includes(customer.recipe);
                const progressText = customer.guaranteed ? 
                    `${currentVisits}/${customer.guaranteed}æ¬¡ (${customer.chance}%æ¦‚ç‡, ç¬¬${customer.guaranteed}æ¬¡å¿…å®š)` :
                    `${currentVisits}/${customer.visits}æ¬¡ (${customer.chance}%æ¦‚ç‡)`;
                
                const statusIcon = isUnlocked ? 'âœ…' : 'âŒ';
                const statusText = isUnlocked ? 'å·²è§£é”' : 'æœªè§£é”';
                const statusColor = isUnlocked ? '#4CAF50' : '#F44336';

                customerRows += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${customer.name}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${customer.recipe}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${progressText}</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: ${statusColor};">
                            ${statusIcon} ${statusText}
                        </td>
                        <td style="padding: 8px; border: 1px solid #ddd;">
                            <button onclick="generateSpecificVip('${customer.name}')" 
                                    style="background: #2196F3; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px;">
                                ç”Ÿæˆ
                            </button>
                            ${!isUnlocked ? `<button onclick="forceUnlockRecipe('${customer.recipe}')" 
                                    style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                                å¼ºåˆ¶è§£é”
                            </button>` : ''}
                        </td>
                    </tr>
                `;
            });

            panel.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #333;">ğŸ¯ VIPé¡¾å®¢æµ‹è¯•é¢æ¿</h2>
                    <button onclick="closeVipTestPanel()" style="background: #F44336; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 16px;">âœ•</button>
                </div>

                <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="margin-top: 0; color: #333;">ğŸ“Š å½“å‰ç»Ÿè®¡</h3>
                    <p><strong>å·²è§£é”é…æ–¹æ•°é‡:</strong> ${unlockedRecipes.length}/17</p>
                    <p><strong>å·²æœåŠ¡é¡¾å®¢:</strong> ${gameData.teaShop.servedCustomers || 0} äºº</p>
                    <p><strong>å½“å‰é¡¾å®¢:</strong> ${gameData.teaShop.customer.active ? gameData.teaShop.customer.name : 'æ— '}</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <button onclick="generateRandomVip()" style="background: #FF9800; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        ğŸ² éšæœºç”ŸæˆVIPé¡¾å®¢
                    </button>
                    <button onclick="clearCurrentCustomer()" style="background: #9E9E9E; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        ğŸš« æ¸…é™¤å½“å‰é¡¾å®¢
                    </button>
                </div>

                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background: #f0f0f0;">
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">VIPé¡¾å®¢</th>
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">è§£é”é…æ–¹</th>
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">è§£é”è¿›åº¦</th>
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">çŠ¶æ€</th>
                            <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${customerRows}
                    </tbody>
                </table>

                <div style="margin-top: 20px; padding: 10px; background: #e3f2fd; border-radius: 5px; font-size: 14px;">
                    <strong>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                    â€¢ ç‚¹å‡»"ç”Ÿæˆ"æŒ‰é’®å¯ä»¥å¼ºåˆ¶ç”ŸæˆæŒ‡å®šçš„VIPé¡¾å®¢ï¼ˆè·³è¿‡30ç§’å†·å´ï¼‰<br>
                    â€¢ ç”Ÿæˆçš„VIPé¡¾å®¢ä¼šæ­£å¸¸è§¦å‘é…æ–¹è§£é”æ£€æŸ¥<br>
                    â€¢ "å¼ºåˆ¶è§£é”"æŒ‰é’®å¯ä»¥ç›´æ¥è§£é”é…æ–¹ï¼Œæ— éœ€æ»¡è¶³æ¡ä»¶<br>
                    â€¢ ç¥ç§˜é¡¾å®¢åŠŸèƒ½æš‚æœªå¼€æ”¾ï¼Œä»…ç”¨äºæµ‹è¯•è®¿é—®è®°å½•
                </div>
            `;

            modal.appendChild(panel);
            document.body.appendChild(modal);
        }

        // ç”Ÿæˆç‰¹å®šVIPé¡¾å®¢
        function generateSpecificVip(customerName) {
            if (!window.teaShopManager) {
                alert('âŒ èŒ¶é“ºç®¡ç†å™¨æœªåŠ è½½');
                return;
            }

            const manager = window.teaShopManager;
            const gameData = manager.core.gameData;
            
            // å¼ºåˆ¶é‡ç½®å†·å´æ—¶é—´ï¼Œå…è®¸ç«‹å³ç”Ÿæˆæ–°é¡¾å®¢
            gameData.teaShop.lastCustomerTime = 0;
            
            // å¼ºåˆ¶ç”ŸæˆæŒ‡å®šçš„VIPé¡¾å®¢
            const customer = gameData.teaShop.customer;
            
            // å¦‚æœå½“å‰æœ‰é¡¾å®¢ï¼Œå…ˆæ¸…é™¤
            if (customer.active) {
                manager.resetCustomer();
            }

            // ç”ŸæˆæŒ‡å®šVIPé¡¾å®¢
            customer.active = true;
            customer.customerType = 'vip';
            customer.isVIP = true;
            customer.name = customerName;
            customer.teaChoice = manager.getRandomAvailableTea();
            customer.toppingChoice = Math.random() < 0.8 ? manager.getRandomAvailableTopping() : null;
            customer.orderType = customer.toppingChoice ? 'tea_with_topping' : 'tea_only';
            customer.arrivalTime = Date.now();
            customer.patience = 240000; // VIP 4åˆ†é’Ÿ
            customer.maxPatience = 240000;

            // è®¢å•éœ€æ±‚
            customer.requirements = {
                needsTea: true,
                needsTopping: !!customer.toppingChoice
            };

            // è®¢å•è¿›åº¦
            customer.progress = {
                teaAdded: false,
                toppingAdded: false
            };

            const orderDesc = customer.requirements.needsTopping
                ? `${customer.teaChoice} + ${customer.toppingChoice}`
                : `${customer.teaChoice} (æ— å°æ–™)`;

            manager.addDebugLog(`ğŸ¯ æµ‹è¯•ç”ŸæˆVIPé¡¾å®¢: ${customerName} - æƒ³è¦ ${orderDesc}`);
            manager.updateCustomerDisplay();
            
            // å…³é—­é¢æ¿
            closeVipTestPanel();
            
            alert(`âœ… å·²ç”ŸæˆVIPé¡¾å®¢ï¼š${customerName}\nè¦æ±‚ï¼š${orderDesc}`);
        }

        // ç”ŸæˆéšæœºVIPé¡¾å®¢
        function generateRandomVip() {
            const vipNames = ['å‡Œå°è·¯', 'èŠ±èŠ±', 'æ±Ÿé£é£', 'æ±Ÿä¸‰', 'æ±Ÿå››', 'æ± äº‘æ——', 'æ±Ÿæ½®', 'æ± æƒŠæš®', 'æ±Ÿæ••å°', 'å§¬åˆ«æƒ…', 'æ± ä¹ä¿¡', 'ç‹¸æ€’'];
            const randomName = vipNames[Math.floor(Math.random() * vipNames.length)];
            generateSpecificVip(randomName);
        }

        // æ¸…é™¤å½“å‰é¡¾å®¢
        function clearCurrentCustomer() {
            if (!window.teaShopManager) {
                alert('âŒ èŒ¶é“ºç®¡ç†å™¨æœªåŠ è½½');
                return;
            }

            const manager = window.teaShopManager;
            manager.resetCustomer();
            manager.addDebugLog('ğŸ§¹ æ‰‹åŠ¨æ¸…é™¤å½“å‰é¡¾å®¢');
            alert('âœ… å½“å‰é¡¾å®¢å·²æ¸…é™¤');
        }

        // å¼ºåˆ¶è§£é”é…æ–¹
        function forceUnlockRecipe(recipeName) {
            if (!window.teaShopManager) {
                alert('âŒ èŒ¶é“ºç®¡ç†å™¨æœªåŠ è½½');
                return;
            }

            const manager = window.teaShopManager;
            const gameData = manager.core.gameData;
            
            if (!gameData.teaShop.unlockedRecipes.includes(recipeName)) {
                gameData.teaShop.unlockedRecipes.push(recipeName);
                manager.core.saveGameData();
                manager.addDebugLog(`ğŸ”“ å¼ºåˆ¶è§£é”é…æ–¹: ${recipeName}`);
                alert(`âœ… å·²å¼ºåˆ¶è§£é”é…æ–¹ï¼š${recipeName}`);
                
                // åˆ·æ–°é¢æ¿æ˜¾ç¤º
                closeVipTestPanel();
                showVipTestPanel();
            } else {
                alert(`â„¹ï¸ é…æ–¹ ${recipeName} å·²ç»è§£é”`);
            }
        }

        // å…³é—­VIPæµ‹è¯•é¢æ¿
        function closeVipTestPanel() {
            const modal = document.getElementById('vip-test-modal');
            if (modal) {
                modal.remove();
            }
        }

        // é‡ç½®é…æ–¹è§£é”çŠ¶æ€
        function resetRecipeUnlockStatus() {
            if (!window.teaShopManager) {
                console.log('âŒ teaShopManager ä¸å­˜åœ¨');
                return;
            }

            // é‡ç½®æ‰€æœ‰VIPè®¿é—®è®¡æ•°
            const vipCustomers = ['å‡Œå°è·¯', 'èŠ±èŠ±', 'æ±Ÿé£é£', 'æ±Ÿä¸‰', 'æ±Ÿå››', 'æ± äº‘æ——', 'æ± æƒŠæš®', 'æ±Ÿæ½®', 'æ±Ÿæ••å°', 'å§¬åˆ«æƒ…', 'æ± ä¹ä¿¡', 'ç‹¸æ€’'];
            const data = window.teaShopManager.core.gameData.teaShop;
            
            // é‡ç½®è®¿é—®è®¡æ•°ï¼ˆä½¿ç”¨æ­£ç¡®çš„å­—æ®µåï¼‰
            data.customerVisits = {};
            if (data.vipUnlockAttempts) {
                data.vipUnlockAttempts = {};
            }
            
            // é‡ç½®æœåŠ¡æ€»æ•°ï¼ˆä½¿ç”¨æ­£ç¡®çš„å­—æ®µåï¼‰
            data.servedCustomers = 0;
            
            // é‡ç½®é…æ–¹è§£é”çŠ¶æ€ï¼ˆä½¿ç”¨æ•°ç»„æ ¼å¼ï¼Œä¿ç•™åŸºç¡€é…æ–¹ï¼‰
            data.unlockedRecipes = ["äº”å‘³å­é¥®", "æŸ æª¬èŒ¶", "è§£æš‘èŒ¶"];
            
            // é‡ç½®èŒ¶é¥®é…æ–¹å¯¹è±¡ï¼ˆåªä¿ç•™åŸºç¡€é…æ–¹ï¼‰
            data.teaRecipes = {
                "äº”å‘³å­é¥®": ["äº”å‘³å­"],
                "æŸ æª¬èŒ¶": ["æŸ æª¬"],
                "è§£æš‘èŒ¶": ["ç”˜è‰"]
            };
            
            // ä¿å­˜æ•°æ®
            window.teaShopManager.core.saveGameData();
            
            // æ›´æ–°èœå•æ˜¾ç¤º
            window.teaShopManager.updateAllDisplays();
            
            // åˆ·æ–°è§£é”çŠ¶æ€é¡µé¢
            window.teaShopManager.showRecipeUnlockStatus();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯çˆ±èŒ¶é“º - ç»Ÿä¸€ç‰ˆæœ¬</title>
    <link rel="stylesheet" href="unified-styles.css">
    <style>
        /* åŠ¨ç”»æç¤ºæ ·å¼ */
        .floating-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            z-index: 9999;
            animation: floatingMessage 2s ease-out forwards;
            pointer-events: none;
        }

        .floating-message.success {
            background: rgba(76, 175, 80, 0.9);
        }

        .floating-message.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .floating-message.cost {
            background: rgba(255, 152, 0, 0.9);
        }

        @keyframes floatingMessage {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -60%) scale(0.9);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="header">
            <h1>å¯çˆ±èŒ¶é“º - å¤é£ç»è¥å°æ¸¸æˆ</h1>
            <div class="subtitle">ç»Ÿä¸€ç‰ˆæœ¬ v2.0 | æ•°æ®å®Œå…¨åŒæ­¥</div>
        </div>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <button class="nav-btn" onclick="location.reload()">èŒ¶é“º</button>
            <button class="nav-btn" onclick="goToRiceVillage()" id="rice-village-btn" disabled>ç¨»é¦™æ‘</button>
            <button class="nav-btn" onclick="showInventory()">èƒŒåŒ…</button>
            <button class="nav-btn" onclick="showShop()" style="background: white; color: #333;">å•†åº—</button>
            <button class="nav-btn" onclick="showSettings()">è®¾ç½®</button>
            <button class="nav-btn" onclick="showHelp()">å¸®åŠ©</button>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="section">
            <div class="section-title">æ¸¸æˆçŠ¶æ€</div>
            <table class="status-table">
                <tr>
                    <th>é‡‘å¸</th>
                    <th>ç­‰çº§</th>
                    <th>ç»éªŒ</th>
                    <th>å¤©æ°”</th>
                    <th>å½“å‰ä½ç½®</th>
                    <th>æ¸¸æˆæ—¶é—´</th>
                </tr>
                <tr>
                    <td id="funds-display">1000 ğŸª™</td>
                    <td id="level-display">1çº§</td>
                    <td id="exp-display">0/100</td>
                    <td id="weather-display">â˜€ï¸ æ™´å¤©</td>
                    <td>èŒ¶é“º</td>
                    <td id="game-time">ç¬¬1å¤©</td>
                </tr>
            </table>
        </div>



        <!-- ç§æ¤åŒºåŸŸ -->
        <div class="section">
            <div class="section-title">ç§æ¤åŒºåŸŸ (2å—åœ°)</div>
            <div class="farm-grid" id="farm-grid">
                <!-- åŠ¨æ€ç”Ÿæˆç§æ¤åœ°å— -->
            </div>
        </div>

        <!-- å¨æˆ¿å·¥ä½œåŒº -->
        <div class="section">
            <div class="section-title">å¨æˆ¿å·¥ä½œåŒº</div>
            
            <!-- ç‚‰ç¶åŒº -->
            <div style="margin-bottom: 15px;">
                <h4 style="font-size: 12px; margin-bottom: 8px;">ç‚‰ç¶åˆ¶èŒ¶åŒº (2ä¸ªç‚‰ç¶)</h4>
                <table class="workspace-table">
                    <thead>
                        <tr>
                            <th>ç‚‰ç¶</th>
                            <th>çŠ¶æ€</th>
                            <th>é…æ–¹</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="stoves-table">
                        <!-- åŠ¨æ€ç”Ÿæˆç‚‰ç¶çŠ¶æ€ -->
                    </tbody>
                </table>
            </div>

            <!-- æ¡ˆæ¿åŒº -->
            <div style="margin-bottom: 15px;">
                <h4 style="font-size: 12px; margin-bottom: 8px;">æ¡ˆæ¿åŠ å·¥åŒº (2ä¸ªæ¡ˆæ¿)</h4>
                <table class="workspace-table">
                    <thead>
                        <tr>
                            <th>æ¡ˆæ¿</th>
                            <th>çŠ¶æ€</th>
                            <th>é…æ–¹</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="boards-table">
                        <!-- åŠ¨æ€ç”Ÿæˆæ¡ˆæ¿çŠ¶æ€ -->
                    </tbody>
                </table>
            </div>

            <!-- çƒ¤è‚‰æ¶åŒº -->
            <div id="grill-section" style="display: none;">
                <h4 style="font-size: 12px; margin-bottom: 8px;">çƒ¤è‚‰æ¶ (è§£é”åå¯ç”¨)</h4>
                <table class="workspace-table">
                    <thead>
                        <tr>
                            <th>çƒ¤è‚‰æ¶</th>
                            <th>çŠ¶æ€</th>
                            <th>é…æ–¹</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="grill-table">
                        <!-- åŠ¨æ€ç”Ÿæˆçƒ¤è‚‰æ¶çŠ¶æ€ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é¡¾å®¢æœåŠ¡åŒº -->
        <div class="section">
            <div class="section-title">é¡¾å®¢æœåŠ¡åŒº</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>å½“å‰é¡¾å®¢</th>
                        <th>è®¢å•è¯¦æƒ…</th>
                        <th>è€å¿ƒå€¼</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="customer-table">
                    <tr>
                        <td colspan="4">ç­‰å¾…é¡¾å®¢åˆ°æ¥...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- çŒ«å’ªç³»ç»Ÿ -->
        <div class="section">
            <div class="section-title">çŒ«å’ªç³»ç»Ÿ</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>çŒ«å’ª</th>
                        <th>äº²å¯†åº¦</th>
                        <th>çŠ¶æ€</th>
                        <th>å–‚é£Ÿæ¬¡æ•°</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="cats-table">
                    <!-- åŠ¨æ€ç”ŸæˆçŒ«å’ªçŠ¶æ€ -->
                </tbody>
            </table>
        </div>

        <!-- åˆ¶ä½œå¥½çš„èŒ¶é¥® -->
        <div class="section">
            <div class="section-title">åˆ¶ä½œå¥½çš„èŒ¶é¥®</div>
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>èŒ¶é¥®åç§°</th>
                        <th>æ•°é‡</th>
                        <th>åˆ¶ä½œæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="made-teas-table">
                    <tr>
                        <td colspan="4">æš‚æ— åˆ¶ä½œå¥½çš„èŒ¶é¥®</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- èƒŒåŒ…å¿«é€ŸæŸ¥çœ‹ -->
        <div class="section">
            <div class="section-title">èƒŒåŒ…å¿«é€ŸæŸ¥çœ‹</div>
            <div class="top-menu-bar">
                <button class="menu-btn" onclick="toggleInventorySection('seeds')">ç§å­</button>
                <button class="menu-btn" onclick="toggleInventorySection('ingredients')">åŸæ–™</button>
                <button class="menu-btn" onclick="toggleInventorySection('toppings')">å°æ–™</button>
                <button class="menu-btn" onclick="toggleInventorySection('meats')">è‚‰ç±»</button>
            </div>
            
            <div id="inventory-display" style="margin-top: 10px;">
                <div class="collapsible-section" id="seeds-section">
                    <table class="inventory-table">
                        <thead><tr><th>ç§å­åç§°</th><th>æ•°é‡</th><th>ä»·æ ¼</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="seeds-inventory"></tbody>
                    </table>
                </div>
                
                <div class="collapsible-section" id="ingredients-section">
                    <table class="inventory-table">
                        <thead><tr><th>åŸæ–™åç§°</th><th>æ•°é‡</th><th>ç”¨é€”</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="ingredients-inventory"></tbody>
                    </table>
                </div>
                
                <div class="collapsible-section" id="toppings-section">
                    <table class="inventory-table">
                        <thead><tr><th>å°æ–™åç§°</th><th>æ•°é‡</th><th>æ¥æº</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="toppings-inventory"></tbody>
                    </table>
                </div>
                
                <div class="collapsible-section" id="meats-section">
                    <table class="inventory-table">
                        <thead><tr><th>è‚‰ç±»åç§°</th><th>æ•°é‡</th><th>çƒ¤åˆ¶ä»·æ ¼</th><th>æ“ä½œ</th></tr></thead>
                        <tbody id="meats-inventory"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‚¬æµ®è°ƒè¯•é¢æ¿ -->
    <div class="debug-panel" id="debug-panel" onclick="toggleDebugPanel()">
        ğŸ› 
        <div class="debug-content" id="debug-content" style="display: none;">
            <div class="debug-header">
                <span>ğŸ›  è°ƒè¯•é¢æ¿</span>
                <button class="modal-close" onclick="toggleDebugPanel()">Ã—</button>
            </div>
            <div style="padding: 10px; font-size: 11px;">
                <div id="debug-log" style="max-height: 200px; overflow-y: auto; background: #f9fafb; padding: 8px; border: 1px solid #e5e7eb; margin-bottom: 8px;"></div>
                <button class="action-btn" onclick="clearDebugLog()" style="font-size: 11px;">æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- JavaScriptæ–‡ä»¶ -->
            <script src="unified-weather-system.js"></script>
        <script src="unified-inventory-system.js"></script>
        <script src="unified-core-system.js"></script>
    <script src="tea-shop-manager.js"></script>
    <script>
        // å…¨å±€èŒ¶é“ºç®¡ç†å™¨å˜é‡
        window.teaShopManager = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸµ èŒ¶é“ºé¡µé¢åŠ è½½å®Œæˆ');

            try {
                // ç›´æ¥åˆ›å»ºèŒ¶é“ºç®¡ç†å™¨å®ä¾‹
                if (typeof TeaShopManager !== 'undefined') {
                    window.teaShopManager = new TeaShopManager();
                    window.teaShopManager.init();
                    console.log('âœ… èŒ¶é“ºç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    console.error('âŒ TeaShopManager ç±»æœªå®šä¹‰');
                }
            } catch (error) {
                console.error('âŒ èŒ¶é“ºç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }

            // ä¸å†åœ¨é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å‘½åéœ€æ±‚
            // å‘½åçª—å£ç°åœ¨ç”±äº²å¯†åº¦è¾¾åˆ°3000æ—¶è§¦å‘
        });

        // æ£€æŸ¥æ˜¯å¦éœ€è¦çŒ«å’ªå‘½å
        function checkCatNamingRequired() {
            console.log('ğŸ± å¼€å§‹æ£€æŸ¥çŒ«å’ªå‘½åéœ€æ±‚');

            if (!teaShopManager || !teaShopManager.core.initialized) {
                console.log('èŒ¶é“ºç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼Œå»¶è¿Ÿæ£€æŸ¥çŒ«å’ªå‘½å');
                setTimeout(checkCatNamingRequired, 500);
                return;
            }

            const gameData = teaShopManager.core.gameData;
            const cats = gameData.teaShop.cats;

            console.log('ğŸ± æ¸¸æˆæ•°æ®:', {
                hasShownCatNaming: gameData.meta.hasShownCatNaming,
                catsIntimacy: cats.intimacy,
                currentCat: cats.currentCat
            });

            // æ£€æŸ¥æ˜¯å¦å·²ç»ç»™çŒ«å’ªèµ·è¿‡åå­— - æ›´ä¸¥æ ¼çš„åˆ¤æ–­
            const hasNamedCat = cats.currentCat && cats.currentCat !== 'ç­‰å¾…çŒ«å’ªåˆ°æ¥' && cats.currentCat.trim() !== '';

            console.log('ğŸ± è¯¦ç»†æ£€æŸ¥:', {
                currentCat: cats.currentCat,
                intimacyKeys: Object.keys(cats.intimacy),
                hasNamedCat: hasNamedCat
            });

            console.log('ğŸ± æ£€æŸ¥ç»“æœ:', {
                hasShownCatNaming: gameData.meta.hasShownCatNaming,
                hasNamedCat: hasNamedCat,
                shouldShowModal: !gameData.meta.hasShownCatNaming && !hasNamedCat
            });

            // æ£€æŸ¥æ˜¯å¦è®¾ç½®è¿‡"å·²å¼¹å‡ºå‘½åçª—å£"æ ‡è®°
            if (!gameData.meta.hasShownCatNaming && !hasNamedCat) {
                console.log('ğŸ± é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œå¼¹å‡ºçŒ«å’ªå‘½åçª—å£');
                showCatNamingModal();
                gameData.meta.hasShownCatNaming = true;
                teaShopManager.core.saveGameData();
            } else {
                console.log('ğŸ± ä¸éœ€è¦å¼¹å‡ºå‘½åçª—å£');
            }
        }

        // æ˜¾ç¤ºçŒ«å’ªå‘½åæ¨¡æ€æ¡†
        function showCatNamingModal(originalCatName) {
            window.currentNamingCat = originalCatName; // ä¿å­˜å½“å‰è¦å‘½åçš„çŒ«å’ª
            const modalContent = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; justify-content: center; align-items: center;">
                    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); max-width: 450px; text-align: center;">
                        <h3 style="margin-top: 0; color: #333;">ğŸ‰ æ­å–œå¼€å¯ç¥ç§˜åœ°å›¾ç¨»é¦™æ‘ï¼</h3>
                        <p style="margin: 20px 0; line-height: 1.6; color: #666;">
                            ä½ çš„ <strong>${originalCatName}</strong> äº²å¯†åº¦è¾¾åˆ°äº†3000ï¼<br>
                            ç¥ç§˜çš„ç¨»é¦™æ‘å¤§é—¨ä¸ºä½ æ•å¼€äº†...<br>
                            è¯·ç»™è¿™åªçŒ«çŒ«èµ·ä¸ªåå­—ï¼Œç„¶åå°±å¯ä»¥å¸¦ç€ä½ çš„çŒ«çŒ«ä¼™ä¼´å»æ¸¸ç©äº†ï¼
                        </p>
                        <div style="margin: 20px 0;">
                            <input type="text" id="cat-name-input" placeholder="è¯·è¾“å…¥çŒ«å’ªåå­—"
                                   style="padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 200px; font-size: 14px;"
                                   maxlength="10">
                        </div>
                        <div>
                            <button onclick="confirmCatNameAndGoToVillage()"
                                    style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                ç¡®è®¤å¹¶å‰å¾€ç¨»é¦™æ‘
                            </button>
                            <button onclick="confirmCatNameOnly()"
                                    style="background: #ccc; color: #333; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                æš‚æ—¶ä¸å»
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalContent);

            // èšç„¦åˆ°è¾“å…¥æ¡†
            setTimeout(() => {
                const input = document.getElementById('cat-name-input');
                if (input) input.focus();
            }, 100);
        }

        // ç¡®è®¤çŒ«å’ªåå­—å¹¶å‰å¾€ç¨»é¦™æ‘
        function confirmCatNameAndGoToVillage() {
            const input = document.getElementById('cat-name-input');
            let catName = input.value.trim();

            if (!catName) {
                alert('è¯·è¾“å…¥çŒ«å’ªåå­—ï¼');
                return;
            }

            applyCatName(catName);
            // å‰å¾€ç¨»é¦™æ‘
            setTimeout(() => {
                window.open('rice-village.html', '_blank');
            }, 500);
        }

        // ç¡®è®¤çŒ«å’ªåå­—ä½†ä¸å‰å¾€ç¨»é¦™æ‘
        function confirmCatNameOnly() {
            const input = document.getElementById('cat-name-input');
            let catName = input.value.trim();

            if (!catName) {
                alert('è¯·è¾“å…¥çŒ«å’ªåå­—ï¼');
                return;
            }

            applyCatName(catName);
        }

        // ç¡®è®¤çŒ«å’ªåå­—ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
        function confirmCatName() {
            confirmCatNameOnly();
        }

        // è·³è¿‡å‘½åï¼ˆéšæœºå‘½åï¼‰
        function skipCatNaming() {
            const randomNames = ['å°ç™½', 'å°é»‘', 'å°èŠ±', 'å°æ©˜', 'å°ç°', 'å’ªå’ª', 'å–µå–µ', 'å›¢å­', 'å¸ƒä¸', 'å¥¶èŒ¶'];
            const randomName = randomNames[Math.floor(Math.random() * randomNames.length)];
            applyCatName(randomName);
        }

        // åº”ç”¨çŒ«å’ªåå­—
        function applyCatName(catName) {
            if (teaShopManager && teaShopManager.core.initialized) {
                const cats = teaShopManager.core.gameData.teaShop.cats;
                const originalName = window.currentNamingCat;

                if (!originalName) {
                    console.log('ğŸ± é”™è¯¯ï¼šæ²¡æœ‰æ‰¾åˆ°è¦å‘½åçš„çŒ«å’ª');
                    return;
                }

                console.log(`ğŸ± å¼€å§‹å‘½å: ${originalName} â†’ ${catName}`);

                // ä¿å­˜è‡ªå®šä¹‰åå­—
                cats.customNames[originalName] = catName;

                // ç”Ÿæˆéšæœºæˆ˜æ–—å±æ€§å’Œç±»å‹
                const catType = Math.random() < 0.5 ? 'tank' : 'damage';
                cats.combatStats[originalName] = {
                    type: catType,
                    baseHp: Math.floor(Math.random() * 51) + 100,   // 100-150åŸºç¡€è¡€é‡
                    baseAttack: Math.floor(Math.random() * 11) + 10, // 10-20åŸºç¡€æ”»å‡»
                    level: 1,
                    hp: 0, // å°†åœ¨ä¸‹é¢è®¡ç®—
                    attack: 0, // å°†åœ¨ä¸‹é¢è®¡ç®—
                    currentHp: 0 // å½“å‰è¡€é‡
                };

                // è®¡ç®—1çº§æ—¶çš„å±æ€§
                const stats = cats.combatStats[originalName];
                if (catType === 'tank') {
                    stats.hp = stats.baseHp + 20; // å¦å…‹å‹+20è¡€é‡
                    stats.attack = stats.baseAttack + 1; // å¦å…‹å‹+1æ”»å‡»
                } else {
                    stats.hp = stats.baseHp + 3; // è¾“å‡ºå‹+3è¡€é‡
                    stats.attack = stats.baseAttack + 5; // è¾“å‡ºå‹+5æ”»å‡»
                }
                stats.currentHp = stats.hp;

                console.log(`ğŸ± ç”Ÿæˆæˆ˜æ–—å±æ€§:`, cats.combatStats[originalName]);

                // å¦‚æœè¿™åªçŒ«å’ªæ­£åœ¨è®¿é—®ï¼Œéœ€è¦æ›´æ–°æ˜¾ç¤ºä½†ä¸æ”¹å˜currentCat
                // currentCatä¿æŒåŸå§‹åå­—ï¼Œæ˜¾ç¤ºæ—¶ç”¨è‡ªå®šä¹‰åå­—

                teaShopManager.core.saveGameData();
                teaShopManager.renderCatsTable();
                teaShopManager.addDebugLog(`ğŸ± ${originalName} ç°åœ¨å« ${catName} äº†ï¼æˆ˜æ–—å±æ€§å·²ç”Ÿæˆï¼`);

                console.log('ğŸ± å‘½åå®Œæˆï¼Œæœ€ç»ˆæ•°æ®:', {
                    customNames: cats.customNames,
                    combatStats: cats.combatStats
                });
            }

            // å…³é—­æ¨¡æ€æ¡†
            const modal = document.querySelector('[style*="position: fixed"][style*="z-index: 2000"]');
            if (modal) {
                modal.remove();
            }
        }



























    </script>
</body>
</html>

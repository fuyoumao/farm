<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨»é¦™æ‘ - ç»Ÿä¸€ç‰ˆæœ¬</title>
    <link rel="stylesheet" href="unified-styles.css?v=2.3">
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="header">
            <h1>ç¨»é¦™æ‘ - RPGå†’é™©æ¨¡å¼</h1>
            <div class="subtitle">ç»Ÿä¸€ç‰ˆæœ¬ v2.0 | æ•°æ®å®Œå…¨åŒæ­¥</div>
        </div>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <button class="nav-btn" onclick="goToTeaShop()">è¿”å›èŒ¶é“º</button>
            <button class="nav-btn" onclick="showInventory()" style="background: #666; color: white;">èƒŒåŒ…</button>
            <button class="nav-btn" onclick="showPartnerSelection()" style="background: #666; color: white;">é€‰æ‹©ä¼™ä¼´</button>
            <!-- æ ¸å¿ƒè°ƒè¯•åŠŸèƒ½ - æŒ‰ç…§é‡å»ºæŒ‡å¯¼æ–‡æ¡£ä¿ç•™ -->
            <button class="nav-btn" onclick="debugNPCStatus()" style="background: #666; color: white;">NPCçŠ¶æ€</button>
            <button class="nav-btn" onclick="debugCurrentQuests()" style="background: #666; color: white;">å½“å‰ä»»åŠ¡</button>
            <button class="nav-btn" onclick="resetKillData()" style="background: #666; color: white;">é‡ç½®å‡»æ€</button>
            <button class="nav-btn" onclick="resetAllGameData()" style="background: #d32f2f; color: white;">å®Œå…¨é‡ç½®</button>
        </div>

        <!-- å¤©æ°”æ—¶é—´ä¿¡æ¯æ  -->
        <div class="weather-info-bar" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: center; align-items: center; gap: 20px;">
            <div class="weather-display" style="display: flex; align-items: center; gap: 8px;">
                <span id="rice-weather-icon" style="font-size: 20px;">â˜€ï¸</span>
                <span id="rice-season-text" style="font-weight: 600; color: #333;">æ˜¥å¤© Â· æ™´å¤©</span>
            </div>
            <div class="day-display" style="display: flex; align-items: center; gap: 8px;">
                <span style="color: #666;">ç¬¬</span>
                <span id="rice-day-number" style="font-weight: 600; color: #333;">1</span>
                <span style="color: #666;">å¤©</span>
            </div>
        </div>

        <!-- è§’è‰²çŠ¶æ€æ  -->
        <div class="section">
            <div class="section-title">è§’è‰²çŠ¶æ€</div>
            <table class="status-table">
                <tr>
                    <th>å§“å</th>
                    <th>æ€§åˆ«</th>
                    <th>ç­‰çº§</th>
                    <th>ç»éªŒ</th>
                    <th>è¡€é‡</th>
                    <th>ä½“åŠ›</th>
                    <th>æ”»å‡»åŠ›</th>
                    <th>é‡‘å¸</th>
                </tr>
                <tr>
                    <td id="player-name">æœªè®¾ç½®</td>
                    <td id="player-gender">æœªè®¾ç½®</td>
                    <td id="player-level">1çº§</td>
                    <td id="player-exp">0/100</td>
                    <td id="player-hp">100/100</td>
                    <td id="player-stamina">100/100</td>
                    <td id="player-power">5</td>
                    <td id="player-funds">1000 ğŸª™</td>
                </tr>
            </table>
        </div>

        <!-- çŒ«å’ªä¼™ä¼´çŠ¶æ€ -->
        <div class="section">
            <div class="section-title">çŒ«å’ªä¼™ä¼´</div>
            <table class="status-table">
                <tr>
                    <th>å½“å‰ä¼™ä¼´</th>
                    <th>ç±»å‹</th>
                    <th>ç­‰çº§</th>
                    <th>è¡€é‡</th>
                    <th>æ”»å‡»åŠ›</th>
                    <th>æ“ä½œ</th>
                </tr>
                <tr>
                    <td id="cat-name">æœªé€‰æ‹©ä¼™ä¼´</td>
                    <td id="cat-type">-</td>
                    <td id="cat-level">-</td>
                    <td id="cat-hp">-</td>
                    <td id="cat-power">-</td>
                    <td>
                        <!-- æ—§æŒ‰é’®å·²åˆ é™¤ - ä½¿ç”¨å¯¼èˆªæ çš„ä¼™ä¼´é€‰æ‹©æŒ‰é’® -->
                    </td>
                </tr>
            </table>
        </div>

        <!-- å¿«é€Ÿæµ‹è¯•æŒ‰é’®å·²åˆ é™¤ - æŒ‰ç…§é‡å»ºæŒ‡å¯¼æ–‡æ¡£æ¸…ç†æ—§ç³»ç»Ÿ -->

        <!-- NPCå¯¹è¯åŒº -->
        <div class="section">
            <div class="section-title">æ‘æ°‘NPC</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>NPCåç§°</th>
                        <th>èŒä¸š</th>
                        <th>ä»»åŠ¡çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="npcs-table">
                    <!-- åŠ¨æ€ç”ŸæˆNPCçŠ¶æ€ -->
                </tbody>
            </table>
        </div>

        <!-- æˆ˜æ–—åŒºåŸŸ -->
        <div class="section">
            <div class="section-title">é‡ç”ŸåŠ¨ç‰©</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>æ€ªç‰©åç§°</th>
                        <th>æè¿°</th>
                        <th>æ‰è½ç‰©å“</th>
                        <th>å½“å‰è¡€é‡</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="monsters-table">
                    <!-- åŠ¨æ€ç”Ÿæˆæ€ªç‰©çŠ¶æ€ -->
                </tbody>
            </table>
        </div>

        <!-- é‡‡é›†åŒºåŸŸ -->
        <div class="section">
            <div class="section-title">æ¤ç‰©é‡‡é›†</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>æ¤ç‰©åç§°</th>
                        <th>æè¿°</th>
                        <th>ç”¨é€”</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="plants-table">
                    <!-- åŠ¨æ€ç”Ÿæˆæ¤ç‰©çŠ¶æ€ -->
                </tbody>
            </table>
        </div>

        <!-- è£…å¤‡ç®¡ç† -->
        <div class="section">
            <div class="section-title">è£…å¤‡ç®¡ç†</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <!-- å½“å‰è£…å¤‡ -->
                <div>
                    <h4 style="font-size: 12px; margin-bottom: 8px;">å½“å‰è£…å¤‡</h4>
                    <table class="inventory-table">
                        <thead>
                            <tr><th>éƒ¨ä½</th><th>è£…å¤‡åç§°</th><th>å±æ€§</th><th>æ“ä½œ</th></tr>
                        </thead>
                        <tbody id="equipped-items">
                            <!-- åŠ¨æ€ç”Ÿæˆå½“å‰è£…å¤‡ -->
                        </tbody>
                    </table>
                </div>
                
                <!-- èƒŒåŒ…è£…å¤‡ -->
                <div>
                    <h4 style="font-size: 12px; margin-bottom: 8px;">èƒŒåŒ…è£…å¤‡</h4>
                    <table class="inventory-table">
                        <thead>
                            <tr><th>è£…å¤‡åç§°</th><th>ç±»å‹</th><th>å±æ€§</th><th>æ“ä½œ</th></tr>
                        </thead>
                        <tbody id="inventory-equipment">
                            <!-- åŠ¨æ€ç”ŸæˆèƒŒåŒ…è£…å¤‡ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- æ­¦å™¨é“ºå·²åˆ é™¤ - æŒ‰ç…§é‡å»ºæŒ‡å¯¼æ–‡æ¡£æ¸…ç†æ—§ç³»ç»Ÿ -->

        <!-- èƒŒåŒ…å¿«é€ŸæŸ¥çœ‹å·²åˆ é™¤ - æŒ‰ç…§é‡å»ºæŒ‡å¯¼æ–‡æ¡£ï¼ŒèƒŒåŒ…åº”ä¸ºå¼¹å‡ºçª—ä½“ -->
    </div>

    <!-- æ‚¬æµ®ä»»åŠ¡é¢æ¿ -->
    <div class="floating-panel" id="quest-panel">
        <h3>å½“å‰ä»»åŠ¡</h3>
        <div id="active-quests">
            <div style="color: #6b7280; font-size: 11px;">æš‚æ— è¿›è¡Œä¸­çš„ä»»åŠ¡</div>
        </div>
    </div>



    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- ç‹¬ç«‹çš„æµ‹è¯•æŒ‰é’® - æ‚¬æµ®åœ¨å³ä¸‹è§’ -->
    <div style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        background: #FFA500;
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        border: none;
        user-select: none;
    " onclick="testCompleteAllQuests()" title="å¿«é€Ÿå®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼Œè®¾ç½®ç©å®¶ä¸º11çº§">
        ğŸ§ª å®Œæˆæ‰€æœ‰ä»»åŠ¡
    </div>

    <!-- æ—§æ‚¬æµ®èƒŒåŒ…å·²åˆ é™¤ - æŒ‰ç…§é‡å»ºæŒ‡å¯¼æ–‡æ¡£ä½¿ç”¨ç‹¬ç«‹èƒŒåŒ…ç³»ç»Ÿ -->

    <!-- æ­¦å™¨é“ºçª—å£å·²åˆ é™¤ - æŒ‰ç…§é‡å»ºæŒ‡å¯¼æ–‡æ¡£æ¸…ç†æ—§ç³»ç»Ÿ -->

    <!-- å¯¹è¯çª—ä½“ -->
    <div id="dialog-window" class="dialog-window">
        <div class="dialog-header">ğŸ’¬ å¯¹è¯</div>
        <div id="dialog-content" class="dialog-content"></div>
        <div id="dialog-options" class="dialog-options"></div>
    </div>

    <!-- JavaScriptæ–‡ä»¶ - æŒ‰ç…§é‡å»ºæ–‡æ¡£è¦æ±‚çš„æ­£ç¡®åŠ è½½é¡ºåº -->
    <script src="unified-core-system.js"></script>
    <script src="unified-inventory-system.js"></script>
    <script src="unified-weather-system.js"></script>
    <script src="rice-village-manager.js"></script>
    <script>
        // ç¡®ä¿ç³»ç»ŸæŒ‰æ­£ç¡®é¡ºåºåˆå§‹åŒ–
        function initializeRiceVillageSystem() {
            console.log('ğŸ® å¼€å§‹åˆå§‹åŒ–ç¨»é¦™æ‘ç³»ç»Ÿ...');
            
            // ç¬¬ä¸€æ­¥ï¼šç¡®ä¿æ ¸å¿ƒç³»ç»Ÿå­˜åœ¨å¹¶å·²åˆå§‹åŒ–
            if (!window.core || !window.core.initialized) {
                console.error('âŒ æ ¸å¿ƒç³»ç»Ÿæœªå°±ç»ª');
                console.log('æ ¸å¿ƒç³»ç»Ÿå­˜åœ¨:', !!window.core);
                console.log('æ ¸å¿ƒç³»ç»Ÿå·²åˆå§‹åŒ–:', window.core ? window.core.initialized : 'N/A');
                return false;
            }
            
            console.log('âœ… æ ¸å¿ƒç³»ç»Ÿå·²å°±ç»ª');
            
            // ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¹¶åˆå§‹åŒ–ç¨»é¦™æ‘ç®¡ç†å™¨
            if (!window.riceVillageManager) {
                try {
                    console.log('ğŸ—ï¸ åˆ›å»ºç¨»é¦™æ‘ç®¡ç†å™¨...');
                    window.riceVillageManager = new RiceVillageManager(window.core);
                    
                    console.log('ğŸš€ åˆå§‹åŒ–ç¨»é¦™æ‘ç®¡ç†å™¨...');
                    const success = window.riceVillageManager.initialize();
                    
                    if (success) {
                        console.log('âœ… ç¨»é¦™æ‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼');
                        console.log('ğŸ¯ ç°åœ¨å¯ä»¥ä½¿ç”¨ä»»åŠ¡è¯Šæ–­åŠŸèƒ½ï¼šfullTaskDiagnosis()');
                        return true;
                    } else {
                        console.error('âŒ ç¨»é¦™æ‘ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥');
                        return false;
                    }
                } catch (error) {
                    console.error('âŒ åˆ›å»ºç¨»é¦™æ‘ç®¡ç†å™¨å¤±è´¥:', error);
                    return false;
                }
            } else {
                console.log('âœ… ç¨»é¦™æ‘ç®¡ç†å™¨å·²å­˜åœ¨');
                return true;
            }
        }
        
        // é¡µé¢åŠ è½½å®ŒæˆåæŒ‰é¡ºåºåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ® ç¨»é¦™æ‘é¡µé¢DOMåŠ è½½å®Œæˆ');
            
            // ä½¿ç”¨æ›´å¯é çš„åˆå§‹åŒ–æ—¶æœº
            if (window.core && window.core.initialized) {
                // æ ¸å¿ƒç³»ç»Ÿå·²å°±ç»ªï¼Œç«‹å³åˆå§‹åŒ–
                initializeRiceVillageSystem();
            } else {
                // æ ¸å¿ƒç³»ç»Ÿæœªå°±ç»ªï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
                let retryCount = 0;
                const maxRetries = 10;
                
                const retryInit = () => {
                    retryCount++;
                    console.log(`ğŸ”„ ç¬¬${retryCount}æ¬¡å°è¯•åˆå§‹åŒ–ç¨»é¦™æ‘ç³»ç»Ÿ...`);
                    
                    if (initializeRiceVillageSystem()) {
                        console.log('ğŸ‰ ç¨»é¦™æ‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼');
                        return;
                    }
                    
                    if (retryCount < maxRetries) {
                        setTimeout(retryInit, 200);
                    } else {
                        console.error('âŒ ç¨»é¦™æ‘ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°');
                        console.log('ğŸ’¡ è¯·æ‰‹åŠ¨åˆ·æ–°é¡µé¢é‡è¯•');
                    }
                };
                
                setTimeout(retryInit, 100);
            }
        });
    </script>

    <script>
        // ä¼™ä¼´é€‰æ‹©ç›¸å…³å…¨å±€å‡½æ•°
        function showCompanionSelector() {
            // è°ƒç”¨æ­£ç¡®çš„ä¼™ä¼´é€‰æ‹©å‡½æ•°
            showPartnerSelection();
        }

        function selectCompanionAndClose(originalName) {
            // è¿™ä¸ªå‡½æ•°æš‚æ—¶ä¸éœ€è¦ï¼Œä¼™ä¼´é€‰æ‹©é€šè¿‡æ¨¡æ€çª—å£å¤„ç†
            console.log('é€‰æ‹©ä¼™ä¼´:', originalName);
        }

        function closeCompanionSelector() {
            const modals = document.querySelectorAll('div[style*="position: fixed"]');
            modals.forEach(modal => {
                if (modal.innerHTML.includes('é€‰æ‹©çŒ«å’ªä¼™ä¼´')) {
                    modal.remove();
                }
            });
        }

        // è¿”å›èŒ¶é“ºå‡½æ•°
        function goToTeaShop() {
            // ä¿å­˜å½“å‰æ•°æ®
            if (window.riceVillageManager && window.riceVillageManager.core) {
                window.riceVillageManager.core.saveGameData();
            }

            // è·³è½¬åˆ°èŒ¶é“º
            window.location.href = 'index.html';
        }



        // è°ƒè¯•ä»»åŠ¡ç³»ç»Ÿ
        function debugQuests() {
            if (!window.riceVillageManager || !window.riceVillageManager.core.initialized) {
                showSimpleAlert('é”™è¯¯ï¼šç¨»é¦™æ‘ç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼');
                return;
            }

            const quests = window.riceVillageManager.core.gameData.quests;
            const killCounts = window.riceVillageManager.core.gameData.riceVillage.killCounts;

            console.log('ğŸ” === ä»»åŠ¡ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯ ===');
            console.log('æ´»è·ƒä»»åŠ¡:', quests.active);
            console.log('å·²å®Œæˆä»»åŠ¡:', quests.completed);
            console.log('å‡»æ€ç»Ÿè®¡:', killCounts);

            let debugInfo = 'ğŸ” ä»»åŠ¡ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯:\\n\\n';
            debugInfo += `æ´»è·ƒä»»åŠ¡æ•°é‡: ${quests.active.length}\\n`;
            debugInfo += `å·²å®Œæˆä»»åŠ¡æ•°é‡: ${quests.completed.length}\\n`;
            debugInfo += `é‡çŒªå‡»æ€æ•°: ${killCounts['é‡çŒª'] || 0}\\n\\n`;

            if (quests.active.length > 0) {
                debugInfo += 'æ´»è·ƒä»»åŠ¡è¯¦æƒ…:\\n';
                quests.active.forEach(quest => {
                    debugInfo += `- ${quest.name}: ${quest.progress}/${quest.required} (${quest.status})\\n`;
                });
            }

            showSimpleAlert(debugInfo);
        }

        // æµ‹è¯•ï¼šå®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼ˆä¿ç•™åˆ˜æ´‹æœ€åä¸€ä¸ªä»»åŠ¡ï¼‰
        function testCompleteAllQuests() {
            if (!window.riceVillageManager || !window.riceVillageManager.core.initialized) {
                console.error('âŒ ç¨»é¦™æ‘ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                showSimpleAlert('é”™è¯¯ï¼šç¨»é¦™æ‘ç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼');
                return;
            }

            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•ï¼šå®Œæˆæ‰€æœ‰ä»»åŠ¡');
            
            const core = window.riceVillageManager.core;
            const gameData = core.gameData;
            
            // è°ƒè¯•ï¼šæ˜¾ç¤ºå½“å‰ç©å®¶çŠ¶æ€
            console.log('ğŸ” å½“å‰ç©å®¶çŠ¶æ€:', {
                level: gameData.player.level,
                exp: gameData.player.exp,
                gold: gameData.player.gold,
                name: gameData.player.name
            });
            
            // æ¸…ç©ºå½“å‰æ´»è·ƒä»»åŠ¡
            gameData.quests.active = [];
            gameData.quests.completed = gameData.quests.completed || [];
            gameData.quests.progress = {};
            
            // è®¾ç½®åˆ˜æ´‹çš„questStageåˆ°9ï¼Œè¿™æ ·ä»–ä¼šç»™å‡ºæœ€åä¸€ä¸ªæ‰¾è½¦å¤«çš„ä»»åŠ¡
            const liuYangNPC = gameData.riceVillage.npcs['åˆ˜æ´‹'];
            if (liuYangNPC) {
                liuYangNPC.questStage = 9;
                console.log('ğŸ“ˆ è®¾ç½®åˆ˜æ´‹questStageåˆ°9');
            } else {
                console.error('âŒ æœªæ‰¾åˆ°åˆ˜æ´‹NPC');
            }
            
            // è®¾ç½®ç‹å©†å©†ä¸ºå®Œå…¨å®ŒæˆçŠ¶æ€
            const wangPoPoNPC = gameData.riceVillage.npcs['ç‹å©†å©†'];
            if (wangPoPoNPC) {
                wangPoPoNPC.questStage = 7;
                console.log('ğŸ“ˆ è®¾ç½®ç‹å©†å©†questStageåˆ°7');
            } else {
                console.error('âŒ æœªæ‰¾åˆ°ç‹å©†å©†NPC');
            }
            
            // ç»™ç©å®¶ç›¸å…³å¥–åŠ±ç‰©å“
            if (core.inventorySystem) {
                // ç‹å©†å©†ä»»åŠ¡å®Œæˆå¥–åŠ±ï¼šç²¾è‡´ä»¤ç‰Œ
                core.inventorySystem.addItem('ç²¾è‡´ä»¤ç‰Œ', 1);
                console.log('ğŸ“¦ æ·»åŠ ç²¾è‡´ä»¤ç‰Œ');
                
                // ç¡®ä¿equipmentæ•°ç»„å­˜åœ¨
                if (!gameData.inventory.equipment) {
                    gameData.inventory.equipment = [];
                }
                
                // æ·»åŠ æ‘é•¿ä½©å‰‘
                const villageChiefSword = {
                    id: 'village_chief_sword_' + Date.now(),
                    name: 'æ‘é•¿ä½©å‰‘',
                    type: 'weapon',
                    attack: 8,
                    equipped: false
                };
                gameData.inventory.equipment.push(villageChiefSword);
                
                // æ·»åŠ è‘£è™æˆ˜åˆ€
                const donghuSaber = {
                    id: 'donghu_saber_' + Date.now(),
                    name: 'è‘£è™æˆ˜åˆ€',
                    type: 'weapon',
                    attack: 12,
                    equipped: false
                };
                gameData.inventory.equipment.push(donghuSaber);
                
                console.log('âš”ï¸ æ·»åŠ æ­¦å™¨è£…å¤‡');
            } else {
                console.error('âŒ ç»Ÿä¸€èƒŒåŒ…ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
            
            // è®¾ç½®è§’è‰²ç­‰çº§åˆ°11çº§ - åŠ å¼ºè°ƒè¯•
            const oldLevel = gameData.player.level;
            const oldExp = gameData.player.exp;
            const oldGold = gameData.player.gold;
            
            gameData.player.level = 11;
            gameData.player.exp = 1200;
            gameData.player.gold = (gameData.player.gold || 0) + 500;
            
            console.log('ğŸ“Š ç­‰çº§è®¾ç½®è¯¦æƒ…:', {
                'åŸç­‰çº§': oldLevel,
                'æ–°ç­‰çº§': gameData.player.level,
                'åŸç»éªŒ': oldExp,
                'æ–°ç»éªŒ': gameData.player.exp,
                'åŸé‡‘å¸': oldGold,
                'æ–°é‡‘å¸': gameData.player.gold
            });
            
            // æ¨¡æ‹Ÿå®Œæˆçš„ä»»åŠ¡ï¼ˆæ·»åŠ åˆ°completedåˆ—è¡¨ï¼‰
            const completedQuests = [
                // åˆ˜æ´‹çš„å‰9ä¸ªä»»åŠ¡
                { id: 'clear_boars', name: 'æ¸…ç†é‡çŒªå¨èƒ', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'collect_food', name: 'æ”¶é›†æ‘æ°‘å£ç²®', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'patrol_supply', name: 'ä¸ºå·¡é€»é˜Ÿæä¾›è¡¥ç»™', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'defense_materials', name: 'æ”¶é›†é˜²å¾¡ææ–™', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'defend_village', name: 'ä¿å«æ‘åº„', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'medical_supplies', name: 'æ”¶é›†æ‘æ°‘ç”Ÿæ´»ç”¨å“', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'healing_tea', name: 'åˆ¶ä½œæ‘æ°‘è¯èŒ¶', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'final_defense', name: 'æ‘åº„æœ€ç»ˆé˜²åŠ¡', npc: 'åˆ˜æ´‹', status: 'completed' },
                { id: 'defeat_donghu', name: 'å‡»è´¥å±±è´¼å¤´ç›®è‘£è™', npc: 'åˆ˜æ´‹', status: 'completed' },
                
                // ç‹å©†å©†çš„æ‰€æœ‰ä»»åŠ¡
                { id: 'deliver_mantou', name: 'ä¸ºç‹å©†å©†é€é¦’å¤´', npc: 'ç‹å©†å©†', status: 'completed' },
                { id: 'collect_zhixuecao', name: 'é‡‡é›†æ­¢è¡€è‰', npc: 'ç‹å©†å©†', status: 'completed' },
                { id: 'kill_guozili', name: 'å‡»è´¥æœå­ç‹¸', npc: 'ç‹å©†å©†', status: 'completed' },
                { id: 'kill_houzi', name: 'å‡»è´¥çŒ´å­', npc: 'ç‹å©†å©†', status: 'completed' },
                { id: 'kill_shanzei_final', name: 'å‡»è´¥å±±è´¼', npc: 'ç‹å©†å©†', status: 'completed' }
            ];
            
            gameData.quests.completed.push(...completedQuests);
            console.log('ğŸ“‹ æ·»åŠ å·²å®Œæˆä»»åŠ¡è®°å½•');
            
            // ä¿å­˜æ•°æ®
            core.saveGameData();
            console.log('ğŸ’¾ æ•°æ®å·²ä¿å­˜');
            
            // å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰ç•Œé¢æ˜¾ç¤º
            if (window.riceVillageManager.updatePlayerStatus) {
                window.riceVillageManager.updatePlayerStatus();
                console.log('ğŸ”„ å·²åˆ·æ–°ç©å®¶çŠ¶æ€æ˜¾ç¤º');
            }
            
            if (window.riceVillageManager.updateQuestDisplay) {
                window.riceVillageManager.updateQuestDisplay();
                console.log('ğŸ”„ å·²åˆ·æ–°ä»»åŠ¡æ˜¾ç¤º');
            }
            
            if (window.riceVillageManager.renderNPCsTable) {
                window.riceVillageManager.renderNPCsTable();
                console.log('ğŸ”„ å·²åˆ·æ–°NPCæ˜¾ç¤º');
            }
            
            // æœ€ç»ˆéªŒè¯
            console.log('ğŸ” è®¾ç½®åç©å®¶çŠ¶æ€:', {
                level: gameData.player.level,
                exp: gameData.player.exp,
                gold: gameData.player.gold,
                åˆ˜æ´‹QuestStage: liuYangNPC ? liuYangNPC.questStage : 'NPCä¸å­˜åœ¨',
                ç‹å©†å©†QuestStage: wangPoPoNPC ? wangPoPoNPC.questStage : 'NPCä¸å­˜åœ¨'
            });
            
            console.log('âœ… æµ‹è¯•å®Œæˆï¼');
            
            // ä½¿ç”¨å¯é çš„å¼¹çª—æ˜¾ç¤ºç»“æœ
            setTimeout(function() {
                try {
                    showSimpleAlert('ğŸ§ª æµ‹è¯•å®Œæˆï¼\\n\\nè®¾ç½®å®Œæˆï¼š\\nâ€¢ åˆ˜æ´‹questStage: 9\\nâ€¢ ç‹å©†å©†questStage: 7\\nâ€¢ ç©å®¶ç­‰çº§: 11çº§\\nâ€¢ æ·»åŠ äº†ç²¾è‡´ä»¤ç‰Œå’Œæ­¦å™¨\\n\\nè¯·æ£€æŸ¥æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œç°åœ¨å¯ä»¥æ‰¾åˆ˜æ´‹å¯¹è¯ï¼');
                } catch (e) {
                    // å¦‚æœshowSimpleAlertå¤±è´¥ï¼Œä½¿ç”¨åŸç”Ÿalert
                    alert('ğŸ§ª æµ‹è¯•å®Œæˆï¼\\n\\nè®¾ç½®å®Œæˆï¼š\\nâ€¢ åˆ˜æ´‹questStage: 9\\nâ€¢ ç‹å©†å©†questStage: 7\\nâ€¢ ç©å®¶ç­‰çº§: 11çº§\\nâ€¢ æ·»åŠ äº†ç²¾è‡´ä»¤ç‰Œå’Œæ­¦å™¨\\n\\nè¯·æ£€æŸ¥æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œç°åœ¨å¯ä»¥æ‰¾åˆ˜æ´‹å¯¹è¯ï¼');
                }
            }, 100);
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœæ¨¡æ€å¼¹çª—ï¼ˆç¡®ä¿æ­£ç¡®å±…ä¸­æ˜¾ç¤ºï¼‰
        function showTestResultModal(title, content, color = '#4CAF50') {
            // ç§»é™¤å·²å­˜åœ¨çš„æµ‹è¯•ç»“æœå¼¹çª—
            const existingModal = document.getElementById('test-result-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // åˆ›å»ºæ¨¡æ€å¼¹çª— - ä½¿ç”¨æ›´å¼ºåˆ¶çš„å®šä½æ–¹å¼
            const modal = document.createElement('div');
            modal.id = 'test-result-modal';
            
            // è·å–è§†çª—å°ºå¯¸
            const viewportWidth = window.innerWidth || document.documentElement.clientWidth;
            const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
            
            // å¼ºåˆ¶è®¾ç½®ä¸ºç»å¯¹å®šä½åˆ°è§†çª—
            modal.style.position = 'fixed';
            modal.style.top = '0px';
            modal.style.left = '0px';
            modal.style.width = viewportWidth + 'px';
            modal.style.height = viewportHeight + 'px';
            modal.style.margin = '0';
            modal.style.padding = '0';
            modal.style.background = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '99999';
            modal.style.display = 'table';
            modal.style.tableLayout = 'fixed';

            const centerCell = document.createElement('div');
            centerCell.style.display = 'table-cell';
            centerCell.style.verticalAlign = 'middle';
            centerCell.style.textAlign = 'center';
            centerCell.style.padding = '20px';

            const panel = document.createElement('div');
            panel.style.cssText = `
                background: #ffffff;
                border: 2px outset #c0c0c0;
                box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
                width: 400px;
                max-width: 90%;
                max-height: 70vh;
                overflow-y: auto;
                font-family: 'MS Sans Serif', sans-serif;
                font-size: 12px;
                border-radius: 0;
                margin: 0 auto;
                display: inline-block;
                text-align: left;
            `;

            const header = document.createElement('div');
            header.style.cssText = `
                background: ${color};
                color: white;
                padding: 8px 12px;
                font-weight: bold;
                font-size: 13px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            `;
            header.innerHTML = `
                <span>${title}</span>
                <button onclick="closeTestResultModal()" style="
                    background: none;
                    border: none;
                    color: white;
                    font-size: 18px;
                    cursor: pointer;
                    padding: 0;
                    width: 24px;
                    height: 24px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">Ã—</button>
            `;

            const body = document.createElement('div');
            body.style.cssText = `
                padding: 20px;
                line-height: 1.6;
                color: #333;
                white-space: pre-line;
                font-size: 13px;
                max-height: 300px;
                overflow-y: auto;
            `;
            body.textContent = content;

            const footer = document.createElement('div');
            footer.style.cssText = `
                padding: 12px 20px;
                text-align: center;
                border-top: 1px solid #e0e0e0;
                background: #f9f9f9;
            `;
            footer.innerHTML = `
                <button onclick="closeTestResultModal()" style="
                    background: ${color};
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    font-size: 12px;
                    cursor: pointer;
                    border-radius: 3px;
                ">ç¡®å®š</button>
            `;

            panel.appendChild(header);
            panel.appendChild(body);
            panel.appendChild(footer);
            centerCell.appendChild(panel);
            modal.appendChild(centerCell);

            // ç›´æ¥æ·»åŠ åˆ°bodyæœ€å‰é¢
            document.body.insertBefore(modal, document.body.firstChild);

            // é˜²æ­¢é¡µé¢æ»šåŠ¨å’Œå…¶ä»–äº¤äº’
            document.body.style.overflow = 'hidden';
            
            // é˜²æ­¢ç‚¹å‡»æ¨¡æ€èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal || e.target === centerCell) {
                    closeTestResultModal();
                }
            });

            // è°ƒè¯•ä¿¡æ¯
            console.log('æ¨¡æ€å¼¹çª—å·²åˆ›å»º:', {
                viewportWidth: viewportWidth,
                viewportHeight: viewportHeight,
                modalElement: modal
            });
        }

        // å…³é—­æµ‹è¯•ç»“æœæ¨¡æ€å¼¹çª—
        function closeTestResultModal() {
            const modal = document.getElementById('test-result-modal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        // ç®€å•å¯é çš„å¼¹çª—å‡½æ•°
        function showSimpleAlert(message) {
            // ç§»é™¤å·²å­˜åœ¨çš„ç®€å•å¼¹çª—
            const existingAlert = document.getElementById('simple-alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            // åˆ›å»ºç®€å•å¼¹çª—
            const alertDiv = document.createElement('div');
            alertDiv.id = 'simple-alert';
            alertDiv.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.7);
                    z-index: 999999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-family: Arial, sans-serif;
                ">
                    <div style="
                        background: white;
                        padding: 20px;
                        border-radius: 8px;
                        max-width: 400px;
                        width: 90%;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                        text-align: center;
                        word-wrap: break-word;
                    ">
                        <div style="
                            margin-bottom: 20px;
                            line-height: 1.6;
                            color: #333;
                            white-space: pre-line;
                            font-size: 14px;
                        ">${message}</div>
                        <button onclick="closeSimpleAlert()" style="
                            background: #4CAF50;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 14px;
                        ">ç¡®å®š</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            document.body.style.overflow = 'hidden';
            
            console.log('ç®€å•å¼¹çª—å·²æ˜¾ç¤º');
        }

        // å…³é—­ç®€å•å¼¹çª—
        function closeSimpleAlert() {
            const alertDiv = document.getElementById('simple-alert');
            if (alertDiv) {
                alertDiv.remove();
                document.body.style.overflow = '';
                console.log('ç®€å•å¼¹çª—å·²å…³é—­');
            }
        }
    </script>
</body>
</html>

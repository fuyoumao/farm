<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¬å·åŸ - ç»Ÿä¸€ç‰ˆæœ¬</title>
    <link rel="stylesheet" href="unified-styles.css">
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="header">
            <h1>æ‰¬å·åŸ - RPGå†’é™©æ¨¡å¼</h1>
            <div class="subtitle">ç»Ÿä¸€ç‰ˆæœ¬ v2.0 | æ•°æ®å®Œå…¨åŒæ­¥</div>
        </div>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <button class="nav-btn" onclick="goToTeaShop()">è¿”å›èŒ¶é“º</button>
            <button class="nav-btn" onclick="showInventory()" style="background: #666; color: white;">èƒŒåŒ…</button>
            <button class="nav-btn" onclick="showPartnerSelection()" style="background: #666; color: white;">é€‰æ‹©ä¼™ä¼´</button>
        </div>

        <!-- å¤©æ°”æ—¶é—´ä¿¡æ¯æ  -->
        <div class="weather-info-bar" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: center; align-items: center; gap: 20px;">
            <div class="weather-display" style="display: flex; align-items: center; gap: 8px;">
                <span id="yangzhou-season-text" style="font-weight: 600; color: #333;">æ‰¬å·åŸ</span>
            </div>
            <div class="day-display" style="display: flex; align-items: center; gap: 8px;">
                <span style="color: #666;">ç¬¬</span>
                <span id="yangzhou-day-number" style="font-weight: 600; color: #333;">1</span>
                <span style="color: #666;">å¤©</span>
            </div>
        </div>

        <!-- è§’è‰²çŠ¶æ€æ  -->
        <div class="section">
            <div class="section-title">è§’è‰²çŠ¶æ€</div>
            <table class="status-table">
                <tr>
                    <th>å§“å</th>
                    <th>æ€§åˆ«</th>
                    <th>ç­‰çº§</th>
                    <th>ç»éªŒ</th>
                    <th>é‡‘å¸</th>
                    <th>æ”»å‡»åŠ›</th>
                    <th>å½“å‰ä¼™ä¼´</th>
                </tr>
                <tr>
                    <td id="player-name">æœªçŸ¥</td>
                    <td id="player-gender">æœªçŸ¥</td>
                    <td id="player-level">1</td>
                    <td id="player-exp">0</td>
                    <td id="player-funds">0</td>
                    <td id="player-attack">5</td>
                    <td id="current-partner">æ— </td>
                </tr>
            </table>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- NPCåŒºåŸŸ -->
            <div class="section">
                <div class="section-title">NPCçŠ¶æ€</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>NPC</th>
                            <th>çŠ¶æ€</th>
                            <th>ä»»åŠ¡é˜¶æ®µ</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="npcs-table">
                        <!-- NPCæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- æ€ªç‰©åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">æ€ªç‰©çŠ¶æ€</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æ€ªç‰©</th>
                            <th>æè¿°</th>
                            <th>æ‰è½</th>
                            <th>è¡€é‡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="monsters-table">
                        <!-- æ€ªç‰©æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- æ¤ç‰©åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">æ¤ç‰©çŠ¶æ€</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æ¤ç‰©</th>
                            <th>æè¿°</th>
                            <th>æ‰è½</th>
                            <th>æ‹¥æœ‰æ•°é‡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="plants-table">
                        <!-- æ¤ç‰©æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- ä»»åŠ¡åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">å½“å‰ä»»åŠ¡</div>
                <div id="quest-display" class="quest-display">
                    <div class="quest-item">
                        <div class="quest-name">æš‚æ— ä»»åŠ¡</div>
                        <div class="quest-description">è¯·ä¸NPCå¯¹è¯æ¥å–ä»»åŠ¡</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯¹è¯æ¡† -->
        <div id="dialog-box" class="dialog-box" style="display: none;">
            <div class="dialog-content">
                <div class="dialog-header">
                    <span id="dialog-npc-name">NPC</span>
                    <button onclick="closeDialog()" class="close-btn">å…³é—­</button>
                </div>
                <div class="dialog-body">
                    <div id="dialog-messages" class="dialog-messages"></div>
                    <div class="dialog-actions">
                        <button id="dialog-action-btn" onclick="handleDialogAction()" class="action-btn">å¯¹è¯</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- å¼•å…¥æ ¸å¿ƒç³»ç»Ÿ -->
    <script src="unified-core-system.js"></script>
    <script src="unified-inventory-system.js"></script>
    <script src="unified-weather-system.js"></script>
    <script src="yangzhou-manager.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let yangzhouManager = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ›ï¸ æ‰¬å·åŸé¡µé¢DOMåŠ è½½å®Œæˆ');

            // ç­‰å¾…å…¨å±€æ ¸å¿ƒç³»ç»Ÿ
            const checkCoreInterval = setInterval(() => {
                if (window.core && window.core.initialized) {
                    clearInterval(checkCoreInterval);
                    console.log('âœ… å…¨å±€æ ¸å¿ƒç³»ç»Ÿå·²å°±ç»ªï¼Œå¼€å§‹åˆå§‹åŒ–æ‰¬å·åŸ');
                    initializeYangzhouPage();
                }
            }, 100);
        });

        // åˆå§‹åŒ–æ‰¬å·åŸé¡µé¢
        function initializeYangzhouPage() {
            try {
                console.log('ğŸ›ï¸ å¼€å§‹åˆå§‹åŒ–æ‰¬å·åŸç®¡ç†å™¨...');

                if (window.YangzhouManager && window.core) {
                    yangzhouManager = new YangzhouManager(window.core);
                    yangzhouManager.initialize();
                    window.yangzhouManager = yangzhouManager;
                    console.log('âœ… æ‰¬å·åŸç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
                } else {
                    console.error('âŒ æ‰¬å·åŸç®¡ç†å™¨ç±»æˆ–æ ¸å¿ƒç³»ç»Ÿæœªæ‰¾åˆ°');
                }
            } catch (error) {
                console.error('âŒ æ‰¬å·åŸé¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        // è¿”å›èŒ¶é“ºå‡½æ•°
        function goToTeaShop() {
            // ä¿å­˜å½“å‰æ•°æ®
            if (window.core) {
                window.core.saveGameData();
            }
            // è·³è½¬åˆ°èŒ¶é“º
            window.location.href = 'index.html';
        }

        // æ˜¾ç¤ºèƒŒåŒ…ç•Œé¢
        function showInventory() {
            console.log('ğŸ’ æ‰¬å·åŸæ˜¾ç¤ºèƒŒåŒ…');

            if (!window.core || !window.core.inventorySystem) {
                alert('èƒŒåŒ…ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }

            const inventory = window.core.inventorySystem.getAllItems();

            let modalContent = `
                <div class="modal-overlay" onclick="closeInventoryModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <span>èƒŒåŒ… - æ‰¬å·åŸ</span>
                            <button class="modal-close" onclick="closeInventoryModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="top-menu-bar">
                                <button class="menu-btn" onclick="showInventoryCategory('all')">å…¨éƒ¨</button>
                                <button class="menu-btn" onclick="showInventoryCategory('seeds')">ç§å­</button>
                                <button class="menu-btn" onclick="showInventoryCategory('ingredients')">åŸæ–™</button>
                                <button class="menu-btn" onclick="showInventoryCategory('toppings')">å°æ–™</button>
                                <button class="menu-btn" onclick="showInventoryCategory('teas')">èŒ¶é¥®</button>
                            </div>
                            <div id="inventory-content">
                                ${generateInventoryContent('all', inventory)}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modal-container').innerHTML = modalContent;
        }

        // å…³é—­èƒŒåŒ…æ¨¡æ€æ¡†
        function closeInventoryModal() {
            document.getElementById('modal-container').innerHTML = '';
        }

        // æ˜¾ç¤ºèƒŒåŒ…åˆ†ç±»
        function showInventoryCategory(category) {
            if (!window.core) return;

            const inventory = window.core.inventorySystem.getAllItems();
            const content = generateInventoryContent(category, inventory);
            document.getElementById('inventory-content').innerHTML = content;
        }

        // ç”ŸæˆèƒŒåŒ…å†…å®¹
        function generateInventoryContent(category, inventory) {
            let content = '<div class="inventory-grid">';

            const categories = {
                'all': ['seeds', 'teaIngredients', 'meatIngredients', 'toppings', 'madeTeas', 'questItems', 'specialItems'],
                'seeds': ['seeds'],
                'ingredients': ['teaIngredients', 'meatIngredients'],
                'toppings': ['toppings'],
                'teas': ['madeTeas']
            };

            const targetCategories = categories[category] || categories['all'];

            targetCategories.forEach(cat => {
                const items = inventory[cat] || {};
                for (const [itemName, count] of Object.entries(items)) {
                    if (count > 0) {
                        content += `
                            <div class="inventory-item">
                                <div class="item-name">${itemName}</div>
                                <div class="item-count">x${count}</div>
                            </div>
                        `;
                    }
                }
            });

            content += '</div>';
            return content;
        }

        // æ˜¾ç¤ºä¼™ä¼´é€‰æ‹©ç•Œé¢
        function showPartnerSelection() {
            alert('ä¼™ä¼´é€‰æ‹©åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // å…³é—­å¯¹è¯æ¡†
        function closeDialog() {
            document.getElementById('dialog-box').style.display = 'none';
        }

        // å¤„ç†å¯¹è¯åŠ¨ä½œ
        function handleDialogAction() {
            if (window.yangzhouManager) {
                window.yangzhouManager.handleDialogAction();
            }
        }

        // ä¸NPCå¯¹è¯
        function talkToNPC(npcName) {
            if (window.yangzhouManager) {
                window.yangzhouManager.talkToNPC(npcName);
            }
        }

        // æ”»å‡»æ€ªç‰©
        function attackMonster(monsterName) {
            if (window.yangzhouManager) {
                window.yangzhouManager.attackMonster(monsterName);
            }
        }

        // é‡‡é›†æ¤ç‰©
        function collectPlant(plantName) {
            if (window.yangzhouManager) {
                window.yangzhouManager.collectPlant(plantName);
            }
        }
    </script>
</body>
</html>

<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="header">
            <h1>æ‰¬å·åŸ - RPGå†’é™©æ¨¡å¼</h1>
            <div class="subtitle">ç»Ÿä¸€ç‰ˆæœ¬ v2.0 | æ•°æ®å®Œå…¨åŒæ­¥</div>
        </div>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <button class="nav-btn" onclick="goToTeaShop()">è¿”å›èŒ¶é“º</button>
            <button class="nav-btn" onclick="showInventory()" style="background: #666; color: white;">èƒŒåŒ…</button>
            <button class="nav-btn" onclick="showPartnerSelection()" style="background: #666; color: white;">é€‰æ‹©ä¼™ä¼´</button>
        </div>

        <!-- å¤©æ°”æ—¶é—´ä¿¡æ¯æ  - ç»Ÿä¸€å¤©æ°”ç³»ç»Ÿ -->
        <div class="weather-info-bar" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: center; align-items: center; gap: 20px;">
            <div class="weather-display" style="display: flex; align-items: center; gap: 8px;">
                <span id="yangzhou-season-text" style="font-weight: 600; color: #333;">æ‰¬å·åŸ</span>
            </div>
            <div class="day-display" style="display: flex; align-items: center; gap: 8px;">
                <span style="color: #666;">ç¬¬</span>
                <span id="yangzhou-day-number" style="font-weight: 600; color: #333;">1</span>
                <span style="color: #666;">å¤©</span>
            </div>
        </div>

        <!-- è§’è‰²çŠ¶æ€æ  -->
        <div class="section">
            <div class="section-title">è§’è‰²çŠ¶æ€</div>
            <table class="status-table">
                <tr>
                    <th>å§“å</th>
                    <th>æ€§åˆ«</th>
                    <th>ç­‰çº§</th>
                    <th>ç»éªŒ</th>
                    <th>é‡‘å¸</th>
                    <th>æ”»å‡»åŠ›</th>
                    <th>å½“å‰ä¼™ä¼´</th>
                </tr>
                <tr>
                    <td id="player-name">æœªçŸ¥</td>
                    <td id="player-gender">æœªçŸ¥</td>
                    <td id="player-level">1</td>
                    <td id="player-exp">0</td>
                    <td id="player-funds">0</td>
                    <td id="player-attack">5</td>
                    <td id="current-partner">æ— </td>
                </tr>
            </table>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- NPCåŒºåŸŸ -->
            <div class="section">
                <div class="section-title">NPCçŠ¶æ€</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>NPC</th>
                            <th>çŠ¶æ€</th>
                            <th>ä»»åŠ¡é˜¶æ®µ</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="npcs-table">
                        <!-- NPCæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- æ€ªç‰©åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">æ€ªç‰©çŠ¶æ€</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æ€ªç‰©</th>
                            <th>æè¿°</th>
                            <th>æ‰è½</th>
                            <th>è¡€é‡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="monsters-table">
                        <!-- æ€ªç‰©æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- æ¤ç‰©åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">æ¤ç‰©çŠ¶æ€</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æ¤ç‰©</th>
                            <th>æè¿°</th>
                            <th>æ‰è½</th>
                            <th>æ‹¥æœ‰æ•°é‡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="plants-table">
                        <!-- æ¤ç‰©æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- ä»»åŠ¡åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">å½“å‰ä»»åŠ¡</div>
                <div id="quest-display" class="quest-display">
                    <div class="quest-item">
                        <div class="quest-name">æš‚æ— ä»»åŠ¡</div>
                        <div class="quest-description">è¯·ä¸NPCå¯¹è¯æ¥å–ä»»åŠ¡</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯¹è¯æ¡† -->
        <div id="dialog-box" class="dialog-box" style="display: none;">
            <div class="dialog-content">
                <div class="dialog-header">
                    <span id="dialog-npc-name">NPC</span>
                    <button onclick="closeDialog()" class="close-btn">å…³é—­</button>
                </div>
                <div class="dialog-body">
                    <div id="dialog-messages" class="dialog-messages"></div>
                    <div class="dialog-actions">
                        <button id="dialog-action-btn" onclick="handleDialogAction()" class="action-btn">å¯¹è¯</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- å¼•å…¥æ ¸å¿ƒç³»ç»Ÿ -->
    <script src="unified-core-system.js"></script>
    <script src="unified-inventory-system.js"></script>
    <script src="unified-weather-system.js"></script>
    <script src="yangzhou-manager.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let yangzhouManager = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ‰¬å·åŸé¡µé¢å¼€å§‹åˆå§‹åŒ–...');

            // ç­‰å¾…æ ¸å¿ƒç³»ç»ŸåŠ è½½
            const initInterval = setInterval(() => {
                if (window.UnifiedCoreSystem) {
                    clearInterval(initInterval);
                    initializeYangzhouPage();
                }
            }, 100);
        });

        // åˆå§‹åŒ–æ‰¬å·åŸé¡µé¢
        function initializeYangzhouPage() {
            try {
                console.log('ğŸ›ï¸ æ‰¬å·åŸé¡µé¢å¼€å§‹åˆå§‹åŒ–...');

                // æ£€æŸ¥æ˜¯å¦å·²æœ‰å…¨å±€æ ¸å¿ƒç³»ç»Ÿå®ä¾‹
                if (window.core && window.core.initialized) {
                    console.log('âœ… å‘ç°å·²åˆå§‹åŒ–çš„å…¨å±€æ ¸å¿ƒç³»ç»Ÿï¼Œç›´æ¥ä½¿ç”¨');
                    initializeYangzhouManager(window.core);
                } else {
                    console.log('â³ ç­‰å¾…å…¨å±€æ ¸å¿ƒç³»ç»Ÿåˆå§‹åŒ–...');
                    // ç­‰å¾…å…¨å±€æ ¸å¿ƒç³»ç»Ÿåˆå§‹åŒ–
                    const checkCoreInterval = setInterval(() => {
                        if (window.core && window.core.initialized) {
                            clearInterval(checkCoreInterval);
                            console.log('âœ… å…¨å±€æ ¸å¿ƒç³»ç»Ÿå·²å°±ç»ªï¼Œå¼€å§‹åˆå§‹åŒ–æ‰¬å·åŸç®¡ç†å™¨');
                            initializeYangzhouManager(window.core);
                        }
                    }, 100);

                    // è¶…æ—¶å¤„ç†
                    setTimeout(() => {
                        if (!window.core || !window.core.initialized) {
                            clearInterval(checkCoreInterval);
                            console.error('âŒ ç­‰å¾…å…¨å±€æ ¸å¿ƒç³»ç»Ÿè¶…æ—¶ï¼Œå°è¯•åˆ›å»ºæ–°å®ä¾‹');
                            createNewCoreSystem();
                        }
                    }, 10000);
                }
            } catch (error) {
                console.error('âŒ æ‰¬å·åŸé¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        // åˆå§‹åŒ–æ‰¬å·åŸç®¡ç†å™¨
        function initializeYangzhouManager(core) {
            try {
                if (window.YangzhouManager) {
                    yangzhouManager = new YangzhouManager(core);
                    yangzhouManager.initialize();
                    window.yangzhouManager = yangzhouManager;
                    console.log('âœ… æ‰¬å·åŸç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
                } else {
                    console.error('âŒ æ‰¬å·åŸç®¡ç†å™¨ç±»æœªæ‰¾åˆ°');
                }
            } catch (error) {
                console.error('âŒ æ‰¬å·åŸç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        // åˆ›å»ºæ–°çš„æ ¸å¿ƒç³»ç»Ÿï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        function createNewCoreSystem() {
            try {
                console.log('ğŸš€ åˆ›å»ºæ–°çš„æ ¸å¿ƒç³»ç»Ÿå®ä¾‹...');
                const core = new UnifiedCoreSystem();

                core.initialize().then(() => {
                    console.log('âœ… æ–°æ ¸å¿ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                    window.core = core;
                    initializeYangzhouManager(core);
                }).catch(error => {
                    console.error('âŒ æ–°æ ¸å¿ƒç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                });
            } catch (error) {
                console.error('âŒ åˆ›å»ºæ–°æ ¸å¿ƒç³»ç»Ÿå¤±è´¥:', error);
            }
        }

        // è¿”å›èŒ¶é“ºå‡½æ•°
        function goToTeaShop() {
            // ä¿å­˜å½“å‰æ•°æ®
            if (window.yangzhouManager && window.yangzhouManager.core) {
                window.yangzhouManager.core.saveGameData();
            }

            // è·³è½¬åˆ°èŒ¶é“º
            window.location.href = 'index.html';
        }

        // æ˜¾ç¤ºèƒŒåŒ…ç•Œé¢ - ä½¿ç”¨ç»Ÿä¸€èƒŒåŒ…ç³»ç»Ÿ
        function showInventory() {
            console.log('ğŸ’ æ‰¬å·åŸæ˜¾ç¤ºèƒŒåŒ…');

            if (!window.yangzhouManager || !window.yangzhouManager.core) {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                return;
            }

            const core = window.yangzhouManager.core;
            const inventory = core.inventorySystem.getAllItems();

            let modalContent = `
                <div class="modal-overlay" onclick="closeInventoryModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <span>èƒŒåŒ… - æ‰¬å·åŸ</span>
                            <button class="modal-close" onclick="closeInventoryModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="top-menu-bar">
                                <button class="menu-btn" onclick="showInventoryCategory('all')">å…¨éƒ¨</button>
                                <button class="menu-btn" onclick="showInventoryCategory('seeds')">ç§å­</button>
                                <button class="menu-btn" onclick="showInventoryCategory('ingredients')">åŸæ–™</button>
                                <button class="menu-btn" onclick="showInventoryCategory('toppings')">å°æ–™</button>
                                <button class="menu-btn" onclick="showInventoryCategory('teas')">èŒ¶é¥®</button>
                                <button class="menu-btn" onclick="showInventoryCategory('meats')">è‚‰ç±»</button>
                            </div>
                            <div id="inventory-content">
                                ${generateInventoryContent('all', inventory)}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modal-container').innerHTML = modalContent;
        }

        // å…³é—­èƒŒåŒ…æ¨¡æ€æ¡†
        function closeInventoryModal() {
            const modalContainer = document.getElementById('modal-container');
            if (modalContainer) {
                modalContainer.innerHTML = '';
            }
        }

        // æ˜¾ç¤ºèƒŒåŒ…åˆ†ç±»
        function showInventoryCategory(category) {
            if (!window.yangzhouManager || !window.yangzhouManager.core) return;

            const inventory = window.yangzhouManager.core.inventorySystem.getAllItems();
            const content = generateInventoryContent(category, inventory);
            const contentElement = document.getElementById('inventory-content');
            if (contentElement) {
                contentElement.innerHTML = content;
            }
        }

        // ç”ŸæˆèƒŒåŒ…å†…å®¹
        function generateInventoryContent(category, inventory) {
            let content = '<div class="inventory-grid">';

            const categories = {
                'all': ['seeds', 'teaIngredients', 'meatIngredients', 'toppings', 'madeTeas', 'questItems', 'specialItems'],
                'seeds': ['seeds'],
                'ingredients': ['teaIngredients', 'meatIngredients'],
                'toppings': ['toppings'],
                'teas': ['madeTeas'],
                'meats': ['meatIngredients']
            };

            const targetCategories = categories[category] || categories['all'];

            targetCategories.forEach(cat => {
                const items = inventory[cat] || {};
                for (const [itemName, count] of Object.entries(items)) {
                    if (count > 0) {
                        content += `
                            <div class="inventory-item">
                                <div class="item-name">${itemName}</div>
                                <div class="item-count">x${count}</div>
                            </div>
                        `;
                    }
                }
            });

            content += '</div>';
            return content;
        }

        // æ˜¾ç¤ºä¼™ä¼´é€‰æ‹©ç•Œé¢
        function showPartnerSelection() {
            if (window.yangzhouManager && window.yangzhouManager.showPartnerSelection) {
                window.yangzhouManager.showPartnerSelection();
            } else {
                alert('ä¼™ä¼´ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }

        // å…³é—­å¯¹è¯æ¡†
        function closeDialog() {
            const dialogBox = document.getElementById('dialog-box');
            if (dialogBox) {
                dialogBox.style.display = 'none';
            }
        }

        // å¤„ç†å¯¹è¯åŠ¨ä½œ
        function handleDialogAction() {
            if (window.yangzhouManager && window.yangzhouManager.handleDialogAction) {
                window.yangzhouManager.handleDialogAction();
            }
        }

        // æ”»å‡»æ€ªç‰©
        function attackMonster(monsterName) {
            if (window.yangzhouManager && window.yangzhouManager.attackMonster) {
                window.yangzhouManager.attackMonster(monsterName);
            } else {
                alert('æˆ˜æ–—ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }

        // é‡‡é›†æ¤ç‰©
        function collectPlant(plantName) {
            if (window.yangzhouManager && window.yangzhouManager.collectPlant) {
                window.yangzhouManager.collectPlant(plantName);
            } else {
                alert('é‡‡é›†ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }

        // ä¸NPCå¯¹è¯
        function talkToNPC(npcName) {
            if (window.yangzhouManager && window.yangzhouManager.talkToNPC) {
                window.yangzhouManager.talkToNPC(npcName);
            } else {
                alert('å¯¹è¯ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }
    </script>
</body>
</html>